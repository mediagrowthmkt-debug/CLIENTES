<!DOCTYPE html>
<html lang="pt-BR">
<!--
    üìÅ Dashboard de Projetos - Media Growth MKT
    
    ‚ú® FUNCIONALIDADES:
    - Preview autom√°tico das p√°ginas usando screenshots
    - Links para vers√µes locais e sites ao vivo
    - Detec√ß√£o autom√°tica de dom√≠nios personalizados via GitHub
    - Sincroniza√ß√£o autom√°tica com reposit√≥rios
    - Visualiza√ß√£o em grade ou lista
    - Busca e filtros por status
    
    üåê SINCRONIZA√á√ÉO AUTOM√ÅTICA:
    1. Clique no bot√£o "Sincronizar GitHub"
    2. O sistema detecta automaticamente todos os dom√≠nios personalizados
    3. Links e previews s√£o atualizados automaticamente
    
    Exemplo de dom√≠nios detectados:
    - bathroom.wolfcarpenters.com
    - built-ins.innovbuildersusa.com
    - painting.innovbuildersusa.com
-->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìÅ Dashboard de Projetos - Media Growth MKT</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-dark: #0f0f0f;
            --bg-card: #1a1a1a;
            --bg-hover: #252525;
            --accent: #6366f1;
            --accent-light: #818cf8;
            --success: #22c55e;
            --warning: #f59e0b;
            --text-primary: #ffffff;
            --text-secondary: #a1a1aa;
            --border: #2a2a2a;
            --shadow: rgba(0,0,0,0.4);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 50px;
            padding: 40px;
            background: linear-gradient(135deg, rgba(99,102,241,0.15) 0%, rgba(139,92,246,0.1) 100%);
            border-radius: 24px;
            border: 1px solid var(--border);
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #fff 0%, #a5b4fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-light);
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Search and Filters */
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .search-box {
            flex: 1;
            max-width: 400px;
            position: relative;
        }
        
        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        .search-box input {
            width: 100%;
            padding: 14px 20px 14px 45px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(99,102,241,0.2);
        }
        
        .filter-btn {
            padding: 14px 24px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: var(--accent);
            border-color: var(--accent);
        }
        
        .refresh-btn {
            padding: 14px 24px;
            background: linear-gradient(135deg, var(--success) 0%, #16a34a 100%);
            border: 1px solid var(--success);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
        }
        
        .refresh-btn:active {
            transform: translateY(0);
        }
        
        .refresh-btn i {
            transition: transform 0.6s ease;
        }
        
        .refresh-btn.refreshing i {
            animation: spin 1s linear infinite;
        }
        
        .sync-btn {
            padding: 14px 24px;
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            border: 1px solid #8b5cf6;
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }
        
        .sync-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }
        
        .sync-btn:active {
            transform: translateY(0);
        }
        
        .sync-btn i {
            transition: transform 0.6s ease;
        }
        
        .sync-btn.syncing i {
            animation: spin 1s linear infinite;
        }
        
        .sync-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .scan-folders-btn {
            padding: 14px 24px;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: 1px solid #f59e0b;
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }
        
        .scan-folders-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }
        
        .scan-folders-btn:active {
            transform: translateY(0);
        }
        
        .scan-folders-btn i {
            transition: transform 0.6s ease;
        }
        
        .scan-folders-btn.scanning i {
            animation: spin 1s linear infinite;
        }
        
        .scan-folders-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 24px;
            box-shadow: 0 10px 30px var(--shadow);
            z-index: 2000;
            display: none;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            animation: slideIn 0.3s ease;
        }
        
        .toast.show {
            display: flex;
        }
        
        .toast.success {
            border-left: 4px solid var(--success);
        }
        
        .toast.error {
            border-left: 4px solid #ef4444;
        }
        
        .toast.info {
            border-left: 4px solid var(--accent);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Client Section */
        .client-section {
            margin-bottom: 60px;
        }
        
        .client-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }
        
        .client-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
        }
        
        .client-info h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .client-info p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .project-count {
            margin-left: auto;
            padding: 8px 16px;
            background: var(--bg-card);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        /* Projects Grid */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }
        
        .project-card {
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .project-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
            box-shadow: 0 20px 40px var(--shadow);
        }
        
        /* Bot√£o de refresh do preview - minimalista */
        .refresh-preview-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 10;
            opacity: 0;
        }
        
        .project-card:hover .refresh-preview-btn {
            opacity: 1;
        }
        
        .refresh-preview-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
            transform: scale(1.1);
        }
        
        .refresh-preview-btn i {
            font-size: 12px;
            transition: transform 0.4s ease;
        }
        
        .refresh-preview-btn.refreshing i {
            animation: spin 0.8s linear infinite;
        }
        
        .refresh-preview-btn.refreshing {
            opacity: 1;
            background: var(--accent);
            color: white;
        }
        
        /* Estilos para list-item refresh button */
        .list-preview {
            position: relative;
        }
        
        .list-preview .refresh-preview-btn {
            width: 22px;
            height: 22px;
            top: 4px;
            right: 4px;
        }
        
        .list-preview .refresh-preview-btn i {
            font-size: 10px;
        }
        
        .list-item:hover .refresh-preview-btn {
            opacity: 1;
        }
        
        /* Badge de aviso de URL inconsistente */
        .warning-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            z-index: 15;
            background: rgba(245, 158, 11, 0.9);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            cursor: help;
            animation: pulse-warning 2s infinite;
        }
        
        @keyframes pulse-warning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .project-card.url-warning {
            border-color: var(--warning);
        }
        
        .project-card.url-warning:hover {
            border-color: var(--warning);
            box-shadow: 0 20px 40px rgba(245, 158, 11, 0.2);
        }
        
        .project-preview {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            position: relative;
            overflow: hidden;
        }
        
        .project-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top;
            transition: transform 0.5s ease;
        }
        
        .project-card:hover .project-preview img {
            transform: scale(1.05);
        }
        
        .project-preview .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .project-preview .loading i {
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }
        
        /* Fallback quando todos os servi√ßos de screenshot falham */
        .preview-fallback {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: var(--text-secondary);
            text-align: center;
            padding: 20px;
        }
        
        .preview-fallback i {
            font-size: 2.5rem;
            color: var(--accent);
            opacity: 0.7;
        }
        
        .preview-fallback span {
            font-size: 0.85rem;
            opacity: 0.8;
        }
        
        .preview-fallback .retry-btn {
            margin-top: 8px;
            padding: 8px 16px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
        }
        
        .preview-fallback .retry-btn:hover {
            background: var(--accent-light);
            transform: scale(1.05);
        }
        
        .preview-fallback .retry-btn i {
            font-size: 0.75rem;
            color: white;
            opacity: 1;
        }
        
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }
        
        .preview-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, rgba(0,0,0,0) 50%, rgba(0,0,0,0.8) 100%);
            opacity: 0;
            transition: opacity 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .project-card:hover .preview-overlay {
            opacity: 1;
        }
        
        .preview-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .preview-btn:hover {
            background: var(--accent);
            transform: scale(1.1);
        }
        
        .project-content {
            padding: 20px;
        }
        
        .project-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-badge {
            font-size: 0.7rem;
            padding: 3px 8px;
            border-radius: 20px;
            font-weight: 500;
        }
        
        .status-production {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .status-active {
            background: rgba(99, 102, 241, 0.2);
            color: #818cf8;
        }
        
        .project-path {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .project-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .project-link {
            flex: 1;
            min-width: 90px;
            padding: 10px 15px;
            background: var(--bg-hover);
            border-radius: 10px;
            text-decoration: none;
            color: var(--text-primary);
            font-size: 0.8rem;
            font-weight: 500;
            text-align: center;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .project-link:hover {
            background: var(--accent);
        }
        
        .project-link.disabled {
            opacity: 0.4;
            pointer-events: none;
        }
        
        .project-link i {
            font-size: 0.9rem;
        }
        
        /* View Mode Toggle */
        .view-toggle {
            display: flex;
            gap: 5px;
            padding: 5px;
            background: var(--bg-card);
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        
        .view-btn {
            padding: 10px 15px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .view-btn.active {
            background: var(--accent);
            color: white;
        }
        
        /* List View */
        .projects-list {
            display: none;
        }
        
        .projects-list.active {
            display: block;
        }
        
        .projects-grid.hidden {
            display: none;
        }
        
        .list-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 15px 20px;
            background: var(--bg-card);
            border-radius: 12px;
            margin-bottom: 10px;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }
        
        .list-item:hover {
            border-color: var(--accent);
            transform: translateX(5px);
        }
        
        .list-preview {
            width: 120px;
            height: 70px;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .list-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: top;
        }
        
        .list-info {
            flex: 1;
        }
        
        .list-info h4 {
            margin-bottom: 5px;
        }
        
        .list-info p {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .list-actions {
            display: flex;
            gap: 10px;
        }
        
        .list-actions a {
            padding: 8px 15px;
            background: var(--bg-hover);
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-primary);
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        
        .list-actions a:hover {
            background: var(--accent);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 20px;
            margin-top: 60px;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
        }
        
        .footer a {
            color: var(--accent-light);
            text-decoration: none;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .stats {
                gap: 20px;
            }
            
            .stat-number {
                font-size: 1.8rem;
            }
            
            .projects-grid {
                grid-template-columns: 1fr;
            }
            
            .client-header {
                flex-wrap: wrap;
            }
            
            .project-count {
                margin-left: 0;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .search-box {
                max-width: 100%;
            }
            
            .refresh-btn, .sync-btn, .scan-folders-btn {
                width: 100%;
                justify-content: center;
            }
            
            .toast {
                bottom: 20px;
                right: 20px;
                left: 20px;
                min-width: auto;
            }
        }
        
        /* Modal Preview */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            padding: 40px;
            overflow: auto;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            max-width: 1400px;
            width: 100%;
            background: var(--bg-card);
            border-radius: 20px;
            overflow: hidden;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .modal-close {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--bg-hover);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .modal-body {
            height: 70vh;
        }
        
        .modal-body iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* No Results */
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .no-results i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üìÅ Dashboard de Projetos</h1>
            <p>Central de gerenciamento de Landing Pages e Sites - Media Growth MKT</p>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalClients">0</div>
                    <div class="stat-label">Clientes</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="totalProjects">0</div>
                    <div class="stat-label">Projetos</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="productionCount">0</div>
                    <div class="stat-label">Em Produ√ß√£o</div>
                </div>
            </div>
        </header>
        
        <div class="controls">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Buscar projetos ou clientes...">
            </div>
            <div class="view-toggle">
                <button class="view-btn active" onclick="setView('grid')"><i class="fas fa-th-large"></i></button>
                <button class="view-btn" onclick="setView('list')"><i class="fas fa-list"></i></button>
            </div>
            <button class="filter-btn active" onclick="filterStatus('all')">Todos</button>
            <button class="filter-btn" onclick="filterStatus('production')">Produ√ß√£o</button>
            <button class="filter-btn" onclick="filterStatus('active')">Ativos</button>
            <button class="scan-folders-btn" onclick="scanWorkspaceFolders()" id="scanFoldersBtn">
                <i class="fas fa-folder-plus"></i>
                <span>Escanear Pastas</span>
            </button>
            <button class="sync-btn" onclick="syncWithGitHub()" id="syncBtn">
                <i class="fab fa-github"></i>
                <span>Atualizar Links</span>
            </button>
            <button class="refresh-btn" onclick="refreshPreviews()">
                <i class="fas fa-sync-alt"></i>
                <span>Atualizar Previews</span>
            </button>
        </div>
        
        <div id="projectsContainer"></div>
        
        <div class="no-results" id="noResults" style="display: none;">
            <i class="fas fa-search"></i>
            <h3>Nenhum projeto encontrado</h3>
            <p>Tente ajustar sua busca ou filtros</p>
        </div>
    </div>
    
    <!-- Modal Preview -->
    <div class="modal" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Preview</h3>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <iframe id="previewFrame"></iframe>
            </div>
        </div>
    </div>
    
    <footer class="footer">
        <p>Media Growth MKT ¬© 2025 | Atualizado em <span id="updateDate"></span></p>
    </footer>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-info-circle"></i>
        <span id="toastMessage">Mensagem</span>
    </div>

    <script>
        // ===========================================
        // SISTEMA DE PERSIST√äNCIA COM LOCALSTORAGE
        // ===========================================
        
        // Chave para salvar no localStorage
        const STORAGE_KEY_DOMAINS = 'dashboard_custom_domains';
        const STORAGE_KEY_PROJECTS = 'dashboard_projects_data';
        
        // Vers√£o do mapeamento de dom√≠nios - incrementar quando adicionar novos dom√≠nios
        // v7: Garantir limpeza completa do cache ao atualizar
        const DOMAINS_VERSION = 11;
        const STORAGE_KEY_VERSION = 'dashboard_domains_version';
        
        // Fun√ß√£o para verificar se precisa atualizar dom√≠nios
        function needsDomainsUpdate() {
            try {
                const savedVersion = localStorage.getItem(STORAGE_KEY_VERSION);
                if (!savedVersion || parseInt(savedVersion) < DOMAINS_VERSION) {
                    // Limpa dados antigos para evitar conflitos
                    console.log('üßπ Limpando cache antigo (vers√£o atualizada)...');
                    localStorage.removeItem(STORAGE_KEY_DOMAINS);
                    localStorage.removeItem(STORAGE_KEY_PROJECTS);
                    localStorage.setItem(STORAGE_KEY_VERSION, DOMAINS_VERSION.toString());
                    return true;
                }
            } catch (e) {}
            return false;
        }
        
        // Executa verifica√ß√£o de vers√£o IMEDIATAMENTE
        needsDomainsUpdate();
        
        // Fun√ß√£o para salvar dom√≠nios no localStorage
        function saveDomainsToStorage(domains) {
            try {
                localStorage.setItem(STORAGE_KEY_DOMAINS, JSON.stringify(domains));
                localStorage.setItem(STORAGE_KEY_VERSION, DOMAINS_VERSION.toString());
                console.log('üíæ Dom√≠nios salvos no localStorage:', Object.keys(domains).length);
            } catch (e) {
                console.warn('‚ö†Ô∏è Erro ao salvar no localStorage:', e);
            }
        }
        
        // Fun√ß√£o para carregar dom√≠nios do localStorage
        function loadDomainsFromStorage() {
            try {
                // Se vers√£o √© antiga, retorna null para for√ßar uso dos defaults
                if (needsDomainsUpdate()) {
                    console.log('üîÑ Atualizando dom√≠nios para nova vers√£o...');
                    localStorage.removeItem(STORAGE_KEY_DOMAINS);
                    return null;
                }
                
                const saved = localStorage.getItem(STORAGE_KEY_DOMAINS);
                if (saved) {
                    const domains = JSON.parse(saved);
                    console.log('üìÇ Dom√≠nios carregados do localStorage:', Object.keys(domains).length);
                    return domains;
                }
            } catch (e) {
                console.warn('‚ö†Ô∏è Erro ao carregar do localStorage:', e);
            }
            return null;
        }
        
        // Fun√ß√£o para salvar projectsData no localStorage
        function saveProjectsToStorage(data) {
            try {
                localStorage.setItem(STORAGE_KEY_PROJECTS, JSON.stringify(data));
                console.log('üíæ Projetos salvos no localStorage');
            } catch (e) {
                console.warn('‚ö†Ô∏è Erro ao salvar projetos:', e);
            }
        }
        
        // Fun√ß√£o para carregar projectsData do localStorage
        function loadProjectsFromStorage() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY_PROJECTS);
                if (saved) {
                    console.log('üìÇ Projetos carregados do localStorage');
                    return JSON.parse(saved);
                }
            } catch (e) {
                console.warn('‚ö†Ô∏è Erro ao carregar projetos:', e);
            }
            return null;
        }
        
        // Configura√ß√£o - Lista de reposit√≥rios conhecidos
        const KNOWN_REPOS = [
            // Banca Pacheco
            '05-lp-queijos-frios',
            '06-link-bio-banca-pacheco',
            
            // INNOV Builders USA
            'KITCHEN-REMODELING-INNOV',
            'CUSTOM-BUILT-INS-INNOV',
            'PAINTING',
            'STAIR-REMODELING-INNOV',
            
            // WOLF Carpentry
            'KITCHEN-REMODELING-WOLF',
            'BATHROOM-REMODELING-WOLF',
            'ADU-HOMEADDITION',
        ];
        
        const GITHUB_USERNAME = 'mediagrowthmkt-debug';
        
        // Configura√ß√£o - Mapeamento de dom√≠nios personalizados
        // Carrega do localStorage primeiro, sen√£o usa defaults
        const DEFAULT_CUSTOM_DOMAINS = {
            // Banca Pacheco
            '03-LANDING-PAGE-PROMOCOES-BANCA': 'promos.bancapacheco.com.br',
            '05-lp-queijos-frios': 'lp.bancapacheco.com.br',
            '06-link-bio-banca-pacheco': 'links.bancapacheco.com.br',
            '07-TABOAS-DE-FRIOS': 'tabuas.bancapacheco.com.br',
            
            // Motel Xenon
            'landing-page-motel': 'lp2.xenonmotel.com.br',
            
            // WOLF Carpentry
            'BATHROOM-REMODELING-WOLF': 'bathroom.wolfcarpenters.com',
            'KITCHEN-REMODELING-WOLF': 'kitchen.wolfcarpenters.com',
            'ADU-HOMEADDITION': 'additions.wolfcarpenters.com',
            
            // INNOV Builders USA
            'CUSTOM-BUILT-INS-INNOV': 'built-ins.innovbuildersusa.com',
            'KITCHEN-REMODELING-INNOV': 'kitchen.innovbuildersusa.com',
            'PAINTING': 'painting.innovbuildersusa.com',
            'STAIR-REMODELING-INNOV': 'stairs.innovbuildersusa.com',
        };
        
        // Carrega dom√≠nios salvos ou usa defaults
        const CUSTOM_DOMAINS = loadDomainsFromStorage() || {...DEFAULT_CUSTOM_DOMAINS};
        
        const GITHUB_PAGES_BASE = 'mediagrowthmkt-debug.github.io';
        
        // Fun√ß√£o para obter URL p√∫blica (GitHub Pages ou dom√≠nio personalizado)
        // Agora suporta subpastas como /google, /meta, etc.
        function getPublicUrl(liveUrl, projectPath = '') {
            if (!liveUrl) return '';
            
            // Se a URL j√° √© um dom√≠nio personalizado (n√£o √© github.io), retorna ela mesma
            if (!liveUrl.includes('github.io')) {
                console.log(`üåê getPublicUrl: URL j√° √© dom√≠nio personalizado: ${liveUrl}`);
                return liveUrl;
            }
            
            // Detecta o reposit√≥rio e subpasta da URL do GitHub Pages
            // Exemplo: https://mediagrowthmkt-debug.github.io/KITCHEN-REMODELING-WOLF/google
            // Captura: repoName = KITCHEN-REMODELING-WOLF, subPath = /google
            const urlParts = liveUrl.replace(/^https?:\/\/[^\/]+\//, ''); // Remove dom√≠nio
            const pathParts = urlParts.split('/');
            const repoName = pathParts[0]; // Primeiro segmento √© o nome do repo
            const subPath = pathParts.slice(1).join('/'); // Resto √© subpasta
            
            console.log(`üîç getPublicUrl: repo="${repoName}", subPath="${subPath}"`);
            
            // Se existe dom√≠nio personalizado para este repo
            if (CUSTOM_DOMAINS[repoName]) {
                const customDomain = CUSTOM_DOMAINS[repoName];
                // Substitui o dom√≠nio GitHub Pages pelo personalizado + subpasta
                const customUrl = subPath ? `https://${customDomain}/${subPath}` : `https://${customDomain}`;
                console.log(`üåü ${repoName}/${subPath} ‚Üí ${customUrl}`);
                return customUrl;
            }
            
            // Retorna a URL original do GitHub Pages
            return liveUrl;
        }
        
        // Fun√ß√£o para extrair subpasta de uma URL
        function getSubPath(url) {
            if (!url) return '';
            // Remove dom√≠nio e pega o path
            const match = url.match(/https?:\/\/[^\/]+(\/.*)?/);
            return match && match[1] ? match[1] : '';
        }
        
        // Fun√ß√£o para verificar se projeto tem dom√≠nio personalizado (n√£o √© github.io)
        function hasCustomDomain(liveUrl) {
            if (!liveUrl) return false;
            
            // Se N√ÉO cont√©m github.io, √© um dom√≠nio personalizado
            if (!liveUrl.includes('github.io')) {
                return true; // URLs como xenonmotel.com.br s√£o dom√≠nios personalizados
            }
            
            // Para URLs github.io, verifica se tem CNAME mapeado
            const urlParts = liveUrl.replace(/^https?:\/\/[^\/]+\//, '');
            const repoName = urlParts.split('/')[0];
            return CUSTOM_DOMAINS[repoName] ? true : false;
        }
        
        // Project Data
        const projectsData = [
            // AMCC Contabilidade
            {
                company: "AMCC Contabilidade",
                companyIcon: "üìä",
                description: "Contabilidade Empresarial - Crici√∫ma/SC",
                projects: [
                    {
                        name: "LP Padr√£o",
                        path: "AMCC/LP PADR√ÉO",
                        localUrl: "AMCC/LP%20PADR√ÉO/index.html",
                        liveUrl: "https://landingpage.grupoamcc.com.br/",
                        githubUrl: "https://github.com/mediagrowthmkt-debug/AMCC-LP",
                        status: "active"
                    },
                    {
                        name: "LP Padr√£o - Google",
                        path: "AMCC/LP PADR√ÉO/google",
                        localUrl: "AMCC/LP%20PADR√ÉO/google/index.html",
                        liveUrl: "https://landingpage.grupoamcc.com.br/google/",
                        status: "active"
                    },
                    {
                        name: "LP Padr√£o - Meta",
                        path: "AMCC/LP PADR√ÉO/meta",
                        localUrl: "AMCC/LP%20PADR√ÉO/meta/index.html",
                        liveUrl: "https://landingpage.grupoamcc.com.br/meta/",
                        status: "active"
                    },
                    {
                        name: "LP Empresas >R$1.000",
                        path: "AMCC/LP-EMPRESAS QUE FATURAM ACIMA DE MIL REAIS POR M√äS",
                        localUrl: "AMCC/LP-EMPRESAS%20QUE%20FATURAM%20ACIMA%20DE%20MIL%20REAIS%20POR%20M√äS/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/LP-EMPRESAS-QUE-FATURAM-ACIMA-DE-MIL-REAIS-POR-M-S/",
                        status: "active"
                    },
                    {
                        name: "LP Escolas Particulares",
                        path: "AMCC/LP-ESCOLAS-PARTICULARES- amcc",
                        localUrl: "AMCC/LP-ESCOLAS-PARTICULARES-%20amcc/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/LP-ESCOLAS-PARTICULARES/",
                        status: "active"
                    },
                    {
                        name: "LP Escolas - Google",
                        path: "AMCC/LP-ESCOLAS-PARTICULARES- amcc/google",
                        localUrl: "AMCC/LP-ESCOLAS-PARTICULARES-%20amcc/google/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/LP-ESCOLAS-PARTICULARES/google",
                        status: "active"
                    },
                    {
                        name: "LP Escolas - Meta",
                        path: "AMCC/LP-ESCOLAS-PARTICULARES- amcc/meta",
                        localUrl: "AMCC/LP-ESCOLAS-PARTICULARES-%20amcc/meta/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/LP-ESCOLAS-PARTICULARES/meta",
                        status: "active"
                    },
                    {
                        name: "LP √ìtica",
                        path: "AMCC/LP-OTICA",
                        localUrl: "AMCC/LP-OTICA/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/LP-OTICA/",
                        status: "active"
                    }
                ]
            },
            // Banca Pacheco
            {
                company: "Banca Pacheco",
                companyIcon: "üßÄ",
                description: "Emp√≥rio e Delicatessen - Crici√∫ma/SC",
                projects: [
                    {
                        name: "Site Principal",
                        path: "BANCA PACHECO",
                        localUrl: "BANCA%20PACHECO/index.html",
                        liveUrl: "https://bancapacheco.com.br",
                        status: "production"
                    },
                    {
                        name: "Site Completo (C√≥pia)",
                        path: "BANCA PACHECO/02-SITE-COMPLETO-COPIA",
                        localUrl: "BANCA%20PACHECO/02-SITE-COMPLETO-COPIA/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/03-LANDING-PAGE-PROMOCOES-BANCA/02-SITE-COMPLETO-COPIA",
                        status: "active"
                    },
                    {
                        name: "LP Promo√ß√µes",
                        path: "BANCA PACHECO/03-LANDING-PAGE-PROMOCOES-BANCA",
                        localUrl: "BANCA%20PACHECO/03-LANDING-PAGE-PROMOCOES-BANCA/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/03-LANDING-PAGE-PROMOCOES-BANCA/",
                        status: "active"
                    },
                    {
                        name: "LP Queijos e Frios",
                        path: "BANCA PACHECO/05-lp-queijos-frios",
                        localUrl: "BANCA%20PACHECO/05-lp-queijos-frios/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/05-lp-queijos-frios/",
                        status: "active"
                    },
                    {
                        name: "Link Bio",
                        path: "BANCA PACHECO/06-link-bio",
                        localUrl: "BANCA%20PACHECO/06-link-bio/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/06-link-bio-banca-pacheco/",
                        status: "active"
                    },
                    {
                        name: "T√°buas de Frios",
                        path: "BANCA PACHECO/07-TABOAS DE FRIOS",
                        localUrl: "BANCA%20PACHECO/07-TABOAS%20DE%20FRIOS/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/07-TABOAS-DE-FRIOS/",
                        status: "active"
                    }
                ]
            },
            // Engitunnel
            {
                company: "Engitunnel",
                companyIcon: "üèóÔ∏è",
                description: "Engenharia e Consultoria - S√£o Paulo/SP",
                projects: [
                    {
                        name: "LP Consultoria",
                        path: "ENGITUNNEL/01 - LP CONSULTORIA",
                        localUrl: "ENGITUNNEL/01%20-%20LP%20CONSULTORIA/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/LP-CONSULTORIA/",
                        status: "active"
                    },
                    {
                        name: "LP Projeto Arquitet√¥nico",
                        path: "ENGITUNNEL/02 - LP PROJETO ARQUITETONICO",
                        localUrl: "ENGITUNNEL/02%20-%20LP%20PROJETO%20ARQUITETONICO/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/LP-PROJETO-ARQUITETONICO/",
                        status: "active"
                    },
                    {
                        name: "LP Consultoria Engenharia",
                        path: "ENGITUNNEL/03 - LP CONSULTORIA ENGENHARIA",
                        localUrl: "ENGITUNNEL/03%20-%20LP%20CONSULTORIA%20ENGENHARIA/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/03---LP-CONSULTORIA-ENGENHARIA/",
                        status: "active"
                    },
                    {
                        name: "LP Consultoria Eng. Civil",
                        path: "ENGITUNNEL/04 - LP CONSULTORIA ENGENHARIA CIVIL",
                        localUrl: "ENGITUNNEL/04%20-%20LP%20CONSULTORIA%20ENGENHARIA%20CIVIL/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/04---LP-CONSULTORIA-ENGENHARIA-CIVIL/",
                        status: "active"
                    },
                    {
                        name: "LP Estabilidade Estrutural",
                        path: "ENGITUNNEL/05 - LP ESTABILIDADE ESTRUTURAL",
                        localUrl: "ENGITUNNEL/05%20-%20LP%20ESTABILIDADE%20ESTRUTURAL/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/05---LP-ESTABILIDADE-ESTRUTURAL/",
                        status: "active"
                    },
                    {
                        name: "LP Fiscaliza√ß√£o Obras",
                        path: "ENGITUNNEL/06 - LP FISCALIZACAO OBRAS",
                        localUrl: "ENGITUNNEL/06%20-%20LP%20FISCALIZACAO%20OBRAS/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/06---LP-FISCALIZACAO-OBRAS/",
                        status: "active"
                    },
                    {
                        name: "LP Gerenciamento Obras",
                        path: "ENGITUNNEL/07 - LP GERENCIAMENTO OBRAS",
                        localUrl: "ENGITUNNEL/07%20-%20LP%20GERENCIAMENTO%20OBRAS/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/07---LP-GERENCIAMENTO-OBRAS/",
                        status: "active"
                    },
                    {
                        name: "LP Inspe√ß√£o Predial",
                        path: "ENGITUNNEL/08 - LP INSPECAO PREDIAL",
                        localUrl: "ENGITUNNEL/08%20-%20LP%20INSPECAO%20PREDIAL/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/08---LP-INSPECAO-PREDIAL/",
                        status: "active"
                    },
                    {
                        name: "LP Avalia√ß√£o e Per√≠cia",
                        path: "ENGITUNNEL/09 - LP AVALIACAO E PERICIA",
                        localUrl: "ENGITUNNEL/09%20-%20LP%20AVALIACAO%20E%20PERICIA/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/09---LP-AVALIACAO-E-PERICIA/",
                        status: "active"
                    },
                    {
                        name: "Linktree",
                        path: "ENGITUNNEL/LINKTREE",
                        localUrl: "ENGITUNNEL/LINKTREE/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/LINKTREE/",
                        status: "active"
                    }
                ]
            },
            // Innov Builders USA
            {
                company: "Innov Builders USA",
                companyIcon: "üî®",
                description: "Construction & Remodeling - MA, USA",
                projects: [
                    {
                        name: "Kitchen Remodeling",
                        path: "INNOV/PRONTAS/KITCHEN REMODELING",
                        localUrl: "INNOV/PRONTAS/KITCHEN%20REMODELING/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/KITCHEN-REMODELING-INNOV/",
                        status: "active"
                    },
                    {
                        name: "Kitchen - Google",
                        path: "INNOV/PRONTAS/KITCHEN REMODELING/google",
                        localUrl: "INNOV/PRONTAS/KITCHEN%20REMODELING/google/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/KITCHEN-REMODELING-INNOV/google",
                        status: "active"
                    },
                    {
                        name: "Kitchen - Meta",
                        path: "INNOV/PRONTAS/KITCHEN REMODELING/meta",
                        localUrl: "INNOV/PRONTAS/KITCHEN%20REMODELING/meta/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/KITCHEN-REMODELING-INNOV/meta",
                        status: "active"
                    },
                    {
                        name: "Custom Built-ins",
                        path: "INNOV/PRONTAS/BUILD-INS",
                        localUrl: "INNOV/PRONTAS/BUILD-INS/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/CUSTOM-BUILT-INS-INNOV/",
                        status: "production"
                    },
                    {
                        name: "Built-ins - Google",
                        path: "INNOV/PRONTAS/BUILD-INS/google",
                        localUrl: "INNOV/PRONTAS/BUILD-INS/google/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/CUSTOM-BUILT-INS-INNOV/google",
                        status: "active"
                    },
                    {
                        name: "Built-ins - Meta",
                        path: "INNOV/PRONTAS/BUILD-INS/meta",
                        localUrl: "INNOV/PRONTAS/BUILD-INS/meta/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/CUSTOM-BUILT-INS-INNOV/meta",
                        status: "active"
                    },
                    {
                        name: "Drop Ceiling",
                        path: "INNOV/PRONTAS/DROP-CEILING",
                        localUrl: "INNOV/PRONTAS/DROP-CEILING/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/CUSTOM-BUILT-INS-INNOV/DROP-CEILING/",
                        status: "active"
                    },
                    {
                        name: "Painting Services",
                        path: "INNOV/PRONTAS/PAINTING",
                        localUrl: "INNOV/PRONTAS/PAINTING/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/PAINTING/",
                        status: "production"
                    },
                    {
                        name: "Stair Remodeling",
                        path: "INNOV/PRONTAS/STAIR-REMODELING",
                        localUrl: "INNOV/PRONTAS/STAIR-REMODELING/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/STAIR-REMODELING-INNOV/",
                        status: "production"
                    },
                    {
                        name: "Link Tree",
                        path: "INNOV/PRONTAS/LINK-TREE",
                        localUrl: "INNOV/PRONTAS/LINK-TREE/index.html",
                        liveUrl: "",
                        status: "active"
                    }
                ]
            },
            // Wolf Carpentry
            {
                company: "Wolf Carpentry",
                companyIcon: "üê∫",
                description: "Premium Carpentry Services - MA, USA",
                projects: [
                    {
                        name: "Kitchen Remodeling",
                        path: "WOLF/KITCHEN REMODELING",
                        localUrl: "WOLF/KITCHEN%20REMODELING/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/KITCHEN-REMODELING-WOLF/",
                        status: "production"
                    },
                    {
                        name: "Bathroom Remodeling",
                        path: "WOLF/BATHROOM REMODELING",
                        localUrl: "WOLF/BATHROOM%20REMODELING/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/BATHROOM-REMODELING-WOLF/",
                        status: "production"
                    },
                    {
                        name: "ADU Home Addition",
                        path: "WOLF/ADU-HOMEADDITION",
                        localUrl: "WOLF/ADU-HOMEADDITION/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/ADU-HOMEADDITION/",
                        status: "active"
                    }
                ]
            },
            // Protec Premium Granite
            {
                company: "Protec Premium Granite",
                companyIcon: "üíé",
                description: "Premium Granite & Quartz - MA, USA",
                projects: [
                    {
                        name: "Site Principal",
                        path: "PROTEC/protecpremiumgranite.com",
                        localUrl: "PROTEC/protecpremiumgranite.com/protecpremiumgranite.com/index.html",
                        liveUrl: "https://protecpremiumgranite.com",
                        status: "production"
                    },
                    {
                        name: "LP Protec Granite",
                        path: "PROTEC/LP-PROTEC-GRANITE-2",
                        localUrl: "PROTEC/LP-PROTEC-GRANITE-2/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/LP-PROTEC-GRANITE-2/",
                        status: "active"
                    },
                    {
                        name: "LP Protec - Google",
                        path: "PROTEC/LP-PROTEC-GRANITE-2/google",
                        localUrl: "PROTEC/LP-PROTEC-GRANITE-2/google/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/LP-PROTEC-GRANITE-2/google/",
                        status: "active"
                    },
                    {
                        name: "LP Protec - Meta",
                        path: "PROTEC/LP-PROTEC-GRANITE-2/meta",
                        localUrl: "PROTEC/LP-PROTEC-GRANITE-2/meta/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/LP-PROTEC-GRANITE-2/meta/",
                        status: "active"
                    },
                    {
                        name: "LP Protec Quartz",
                        path: "PROTEC/LP-PROTEC-QUARTZ",
                        localUrl: "PROTEC/LP-PROTEC-QUARTZ/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/LP-PROTEC-QUARTZ/",
                        status: "active"
                    },
                    {
                        name: "LP Contractors",
                        path: "PROTEC/LP-CONTRACTORS-ARQUITECTS",
                        localUrl: "PROTEC/LP-CONTRACTORS-ARQUITECTS/index.html",
                        liveUrl: "",
                        status: "active"
                    }
                ]
            },
            // Motel Xenon
            {
                company: "Motel Xenon",
                companyIcon: "üåô",
                description: "Motel Tem√°tico - Crici√∫ma/SC",
                projects: [
                    {
                        name: "Site Principal",
                        path: "MOTEL XENON",
                        localUrl: "MOTEL%20XENON/index.html",
                        liveUrl: "https://xenonmotel.com.br",
                        status: "production"
                    },
                    {
                        name: "Landing Page Principal",
                        path: "MOTEL XENON",
                        localUrl: "MOTEL%20XENON/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/landing-page-motel/",
                        status: "production"
                    },
                    {
                        name: "Landing Page 01",
                        path: "MOTEL XENON/landing-page-motel-01",
                        localUrl: "MOTEL%20XENON/landing-page-motel-01/index.html",
                        liveUrl: "",
                        status: "active"
                    },
                    {
                        name: "Landing Page 02",
                        path: "MOTEL XENON/landing-page-motel-02",
                        localUrl: "MOTEL%20XENON/landing-page-motel-02/index.html",
                        liveUrl: "",
                        status: "active"
                    },
                    {
                        name: "Motel Crici√∫ma",
                        path: "MOTEL XENON/motel-criciuma",
                        localUrl: "MOTEL%20XENON/motel-criciuma/index.html",
                        liveUrl: "",
                        status: "active"
                    },
                    {
                        name: "Perto/Pr√≥ximo",
                        path: "MOTEL XENON/perto-proximo",
                        localUrl: "MOTEL%20XENON/perto-proximo/index.html",
                        liveUrl: "https://mediagrowthmkt-debug.github.io/landing-page-motel/perto-proximo/",
                        status: "active"
                    }
                ]
            }
        ];
        
        // ===========================================
        // SISTEMA DE AUTO-DETEC√á√ÉO DE URLs
        // ===========================================
        
        // Mapeamento de dom√≠nios principais por cliente
        const CLIENT_DOMAINS = {
            'Motel Xenon': 'https://xenonmotel.com.br',
            'Banca Pacheco': 'https://bancapacheco.com.br',
            'AMCC Contabilidade': 'https://landingpage.grupoamcc.com.br',
            // Adicione outros clientes aqui
        };
        
        // Fun√ß√£o para auto-gerar liveUrl baseado no path do projeto
        function autoGenerateLiveUrl(project, clientName) {
            // Se j√° tem liveUrl v√°lida, n√£o faz nada
            if (project.liveUrl && project.liveUrl.trim() !== '') {
                return project.liveUrl;
            }
            
            // Verifica se o cliente tem dom√≠nio principal configurado
            const clientDomain = CLIENT_DOMAINS[clientName];
            if (!clientDomain) {
                return '';
            }
            
            // Extrai o nome da subpasta do path
            const pathParts = project.path.split('/');
            if (pathParts.length > 1) {
                // √â uma subpasta - gera URL automaticamente
                const subFolder = pathParts.slice(1).join('/').toLowerCase().replace(/\s+/g, '-');
                const generatedUrl = `${clientDomain}/${subFolder}/`;
                console.log(`üîÑ Auto-gerada URL para "${project.name}": ${generatedUrl}`);
                return generatedUrl;
            }
            
            return '';
        }
        
        // Aplica auto-gera√ß√£o de URLs para todos os projetos
        function autoFillMissingUrls() {
            let urlsGenerated = 0;
            projectsData.forEach(client => {
                client.projects.forEach(project => {
                    if (!project.liveUrl || project.liveUrl.trim() === '') {
                        const generatedUrl = autoGenerateLiveUrl(project, client.company);
                        if (generatedUrl) {
                            project.liveUrl = generatedUrl;
                            urlsGenerated++;
                        }
                    }
                });
            });
            if (urlsGenerated > 0) {
                console.log(`‚úÖ ${urlsGenerated} URLs auto-geradas para projetos sem liveUrl`);
            }
        }
        
        // ===========================================
        // SISTEMA DE AUTO-CORRE√á√ÉO DE URLs QUEBRADAS
        // ===========================================
        
        // Cache de URLs validadas/corrigidas (evita validar a mesma URL m√∫ltiplas vezes)
        const URL_VALIDATION_CACHE = {};
        
        // Fun√ß√£o para extrair informa√ß√µes do reposit√≥rio de uma URL
        function extractRepoFromUrl(url) {
            if (!url) return null;
            
            // Padr√£o GitHub Pages: https://user.github.io/REPO/path
            const ghPagesMatch = url.match(/https?:\/\/([^.]+)\.github\.io\/([^\/]+)(\/.*)?/);
            if (ghPagesMatch) {
                return {
                    username: ghPagesMatch[1],
                    repo: ghPagesMatch[2],
                    subPath: ghPagesMatch[3] || ''
                };
            }
            
            return null;
        }
        
        // Fun√ß√£o para buscar CNAME de um reposit√≥rio
        async function fetchCNAME(username, repo) {
            const branches = ['main', 'master', 'gh-pages'];
            
            for (const branch of branches) {
                try {
                    const response = await fetch(
                        `https://raw.githubusercontent.com/${username}/${repo}/${branch}/CNAME`,
                        { method: 'GET', cache: 'no-cache' }
                    );
                    
                    if (response.ok) {
                        const cname = (await response.text()).trim();
                        if (cname && cname.includes('.') && !cname.includes('github.io')) {
                            return cname;
                        }
                    }
                } catch (e) {
                    // Ignora erros silenciosamente
                }
            }
            
            return null;
        }
        
        // Fun√ß√£o principal de valida√ß√£o e corre√ß√£o de URL
        async function validateAndFixUrl(url, projectInfo = {}) {
            if (!url || !url.trim()) return { valid: false, url: '', error: 'URL vazia' };
            
            // Normaliza URL
            let normalizedUrl = url.trim();
            if (!normalizedUrl.startsWith('http')) {
                normalizedUrl = 'https://' + normalizedUrl;
            }
            
            // Verifica cache primeiro
            if (URL_VALIDATION_CACHE[normalizedUrl]) {
                const cached = URL_VALIDATION_CACHE[normalizedUrl];
                if (Date.now() - cached.timestamp < 300000) { // Cache v√°lido por 5 minutos
                    return cached.result;
                }
            }
            
            try {
                // Extrai informa√ß√µes do reposit√≥rio se for GitHub Pages
                const repoInfo = extractRepoFromUrl(normalizedUrl);
                
                if (repoInfo) {
                    // √â uma URL do GitHub Pages - vamos verificar se tem CNAME
                    console.log(`üîç Verificando CNAME para ${repoInfo.repo}...`);
                    
                    const cname = await fetchCNAME(repoInfo.username, repoInfo.repo);
                    
                    if (cname) {
                        // Constr√≥i a nova URL com o dom√≠nio customizado
                        let newUrl = `https://${cname}`;
                        
                        // O subPath do GitHub Pages muitas vezes inclui o nome do repo duplicado
                        // Ex: github.io/AMCC-LP/LP%20PADR√ÉO ‚Üí landingpage.grupoamcc.com.br/ (n√£o /LP%20PADR√ÉO)
                        // Precisamos verificar se a estrutura do dom√≠nio customizado √© diferente
                        
                        // Se a subPath √© o "index" ou raiz do repo, n√£o adiciona
                        const cleanSubPath = repoInfo.subPath.replace(/^\//, '').replace(/\/$/, '');
                        
                        // Verifica se o subPath √© uma pasta real do repo ou uma pasta "virtual"
                        if (cleanSubPath) {
                            // Tenta verificar se o caminho existe no dom√≠nio customizado
                            try {
                                const testUrl = `https://${cname}/${cleanSubPath}/`;
                                const testResponse = await fetch(testUrl, { 
                                    method: 'HEAD', 
                                    mode: 'cors',
                                    cache: 'no-cache'
                                });
                                
                                if (testResponse.ok) {
                                    newUrl = testUrl;
                                    console.log(`‚úÖ Subpasta validada: ${testUrl}`);
                                } else {
                                    // Tenta sem trailing slash
                                    const testUrl2 = `https://${cname}/${cleanSubPath}`;
                                    const testResponse2 = await fetch(testUrl2, { 
                                        method: 'HEAD', 
                                        mode: 'cors',
                                        cache: 'no-cache'
                                    });
                                    
                                    if (testResponse2.ok) {
                                        newUrl = testUrl2;
                                    } else {
                                        // Subpasta n√£o existe, usa raiz
                                        console.log(`‚ö†Ô∏è Subpasta ${cleanSubPath} n√£o existe no dom√≠nio, usando raiz`);
                                        newUrl = `https://${cname}/`;
                                    }
                                }
                            } catch (e) {
                                // Em caso de erro CORS, assume que a URL est√° correta
                                newUrl = `https://${cname}/${cleanSubPath}/`;
                            }
                        } else {
                            newUrl = `https://${cname}/`;
                        }
                        
                        console.log(`üîÑ URL corrigida: ${normalizedUrl} ‚Üí ${newUrl}`);
                        
                        const result = { 
                            valid: true, 
                            url: newUrl, 
                            corrected: true, 
                            originalUrl: normalizedUrl,
                            cname: cname
                        };
                        
                        URL_VALIDATION_CACHE[normalizedUrl] = { result, timestamp: Date.now() };
                        return result;
                    }
                }
                
                // URL n√£o √© GitHub Pages ou n√£o tem CNAME - valida diretamente
                const result = { valid: true, url: normalizedUrl, corrected: false };
                URL_VALIDATION_CACHE[normalizedUrl] = { result, timestamp: Date.now() };
                return result;
                
            } catch (error) {
                console.error(`‚ùå Erro ao validar URL ${normalizedUrl}:`, error);
                return { valid: false, url: normalizedUrl, error: error.message };
            }
        }
        
        // ===========================================
        // SISTEMA DE DETEC√á√ÉO E CORRE√á√ÉO DE URLs QUEBRADAS
        // ===========================================
        
        // Mapeamento de pastas locais para reposit√≥rios GitHub
        // Usado para detectar automaticamente qual reposit√≥rio corresponde a cada pasta
        const LOCAL_TO_REPO_MAPPING = {
            'MOTEL XENON': 'landing-page-motel',
            'AMCC': 'AMCC-LP',
            'BANCA PACHECO': null, // Site principal n√£o est√° no GitHub
            // Adicione outros mapeamentos conforme necess√°rio
        };
        
        // Fun√ß√£o para detectar se uma URL externa existe (retorna 200 ou redirect v√°lido)
        async function checkUrlExists(url) {
            if (!url || url === '' || url === '#') return { exists: false, reason: 'URL vazia' };
            
            try {
                // Usa fetch com mode: 'no-cors' para evitar erros de CORS
                // Isso n√£o nos d√° o status, mas podemos verificar se a requisi√ß√£o falha
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                // Tenta fazer um HEAD request via proxy ou diretamente
                const response = await fetch(url, {
                    method: 'HEAD',
                    mode: 'no-cors',
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                // Com no-cors, n√£o temos acesso ao status, ent√£o assumimos que funciona
                // se n√£o houver erro de rede
                return { exists: true };
            } catch (error) {
                // Erro de rede ou timeout
                return { exists: false, reason: error.message };
            }
        }
        
        // Fun√ß√£o para encontrar o reposit√≥rio correto para um projeto local
        async function findCorrectRepoForProject(project, clientName) {
            const projectPath = project.path;
            const projectName = project.name;
            
            // Extrai a pasta raiz do projeto
            const rootFolder = projectPath.split('/')[0];
            
            console.log(`üîç Buscando reposit√≥rio para: ${projectPath} (cliente: ${clientName})`);
            
            // 1. Verifica se existe mapeamento direto
            if (LOCAL_TO_REPO_MAPPING[rootFolder]) {
                const repoName = LOCAL_TO_REPO_MAPPING[rootFolder];
                console.log(`   üì¶ Mapeamento encontrado: ${rootFolder} ‚Üí ${repoName}`);
                
                // Verifica se a subpasta existe no reposit√≥rio
                const subPath = projectPath.replace(rootFolder, '').replace(/^\//, '');
                
                if (subPath) {
                    // Verifica se a subpasta existe no reposit√≥rio
                    try {
                        const response = await fetch(
                            `https://api.github.com/repos/${GITHUB_USERNAME}/${repoName}/contents/${subPath}`,
                            { method: 'GET' }
                        );
                        
                        if (response.ok) {
                            console.log(`   ‚úÖ Subpasta '${subPath}' existe no repo '${repoName}'`);
                            return { repo: repoName, subPath: subPath, exists: true };
                        } else {
                            console.log(`   ‚ö†Ô∏è Subpasta '${subPath}' N√ÉO existe no repo '${repoName}'`);
                            return { repo: repoName, subPath: subPath, exists: false };
                        }
                    } catch (e) {
                        console.log(`   ‚ùå Erro ao verificar subpasta: ${e.message}`);
                        return { repo: repoName, subPath: subPath, exists: false };
                    }
                } else {
                    // Projeto √© a raiz do reposit√≥rio
                    return { repo: repoName, subPath: '', exists: true };
                }
            }
            
            // 2. Tenta encontrar reposit√≥rio pelo nome do projeto
            const possibleRepoNames = [
                projectPath.replace(/ /g, '-').toUpperCase(),
                projectPath.replace(/ /g, '-').toLowerCase(),
                rootFolder.replace(/ /g, '-'),
                projectName.replace(/ /g, '-')
            ];
            
            for (const repoName of possibleRepoNames) {
                try {
                    const response = await fetch(
                        `https://api.github.com/repos/${GITHUB_USERNAME}/${repoName}`,
                        { method: 'GET' }
                    );
                    
                    if (response.ok) {
                        console.log(`   ‚úÖ Reposit√≥rio encontrado: ${repoName}`);
                        return { repo: repoName, subPath: '', exists: true };
                    }
                } catch (e) {
                    // Continua tentando
                }
            }
            
            console.log(`   ‚ùå Nenhum reposit√≥rio encontrado para: ${projectPath}`);
            return null;
        }
        
        // Fun√ß√£o para detectar e corrigir URLs que apontam para p√°ginas 404
        async function detectAndFixBrokenUrls() {
            console.log('\nüîç Detectando URLs quebradas ou incorretas...');
            let fixedCount = 0;
            let brokenCount = 0;
            const brokenUrls = [];
            
            for (const client of projectsData) {
                for (const project of client.projects) {
                    if (!project.liveUrl || project.liveUrl === '') continue;
                    
                    const url = project.liveUrl;
                    
                    // Ignora URLs do GitHub Pages (j√° tratadas por autoFixAllUrls)
                    if (url.includes('github.io')) continue;
                    
                    // Verifica se a URL tem subpasta que pode n√£o existir
                    const urlObj = new URL(url);
                    const hasSubPath = urlObj.pathname && urlObj.pathname !== '/' && urlObj.pathname !== '';
                    
                    if (hasSubPath) {
                        console.log(`üîé Verificando URL com subpasta: ${url}`);
                        
                        // Busca o reposit√≥rio correto para este projeto
                        const repoInfo = await findCorrectRepoForProject(project, client.company);
                        
                        if (repoInfo) {
                            if (repoInfo.exists) {
                                // A subpasta existe no reposit√≥rio, verifica se o dom√≠nio est√° correto
                                const customDomain = CUSTOM_DOMAINS[repoInfo.repo];
                                if (customDomain) {
                                    const correctUrl = repoInfo.subPath 
                                        ? `https://${customDomain}/${repoInfo.subPath}/`
                                        : `https://${customDomain}/`;
                                    
                                    if (url !== correctUrl && url !== correctUrl.replace(/\/$/, '')) {
                                        console.log(`   ‚úèÔ∏è Corrigindo: ${url} ‚Üí ${correctUrl}`);
                                        project.liveUrl = correctUrl;
                                        fixedCount++;
                                    }
                                }
                            } else {
                                // A subpasta N√ÉO existe - marca como URL quebrada
                                console.log(`   ‚ö†Ô∏è URL quebrada (subpasta n√£o publicada): ${url}`);
                                brokenUrls.push({
                                    client: client.company,
                                    project: project.name,
                                    url: url,
                                    reason: `Subpasta '${repoInfo.subPath}' n√£o existe no reposit√≥rio '${repoInfo.repo}'`
                                });
                                
                                // Limpa a URL para indicar que n√£o est√° publicada
                                project.liveUrl = '';
                                brokenCount++;
                            }
                        }
                    }
                }
            }
            
            if (brokenUrls.length > 0) {
                console.log('\n‚ö†Ô∏è URLs QUEBRADAS ENCONTRADAS:');
                brokenUrls.forEach(item => {
                    console.log(`   - ${item.client} / ${item.project}: ${item.url}`);
                    console.log(`     Motivo: ${item.reason}`);
                });
            }
            
            return { fixed: fixedCount, broken: brokenCount, brokenUrls: brokenUrls };
        }
        
        // Fun√ß√£o para corrigir URLs do GitHub Pages que deveriam usar dom√≠nio customizado
        async function autoFixAllUrls() {
            console.log('üîß Iniciando auto-corre√ß√£o de URLs (somente github.io ‚Üí dom√≠nio custom)...');
            let correctedCount = 0;
            let errorCount = 0;
            
            for (const client of projectsData) {
                for (const project of client.projects) {
                    // S√≥ corrige URLs que usam github.io
                    if (project.liveUrl && project.liveUrl.includes('github.io')) {
                        try {
                            const validation = await validateAndFixUrl(project.liveUrl, {
                                client: client.company,
                                project: project.name
                            });
                            
                            if (validation.corrected && validation.url !== project.liveUrl) {
                                console.log(`‚úÖ ${client.company} / ${project.name}:`);
                                console.log(`   Antes: ${project.liveUrl}`);
                                console.log(`   Depois: ${validation.url}`);
                                project.liveUrl = validation.url;
                                correctedCount++;
                            }
                        } catch (e) {
                            errorCount++;
                            console.error(`‚ùå Erro ao corrigir ${project.name}: ${e.message}`);
                        }
                    }
                }
            }
            
            if (correctedCount > 0) {
                // Salva as corre√ß√µes
                saveProjectsToStorage(projectsData);
                console.log(`‚úÖ ${correctedCount} URLs corrigidas automaticamente!`);
            }
            
            return { corrected: correctedCount, errors: errorCount };
        }
        
        // Fun√ß√£o para for√ßar limpeza do cache e usar URLs do c√≥digo-fonte
        function forceResetToSourceUrls() {
            console.log('üîÑ For√ßando reset para URLs do c√≥digo-fonte...');
            
            // Limpa todo o localStorage relacionado ao dashboard
            localStorage.removeItem(STORAGE_KEY_DOMAINS);
            localStorage.removeItem(STORAGE_KEY_PROJECTS);
            localStorage.removeItem(STORAGE_KEY_VERSION);
            
            // Limpa cache de valida√ß√£o
            Object.keys(URL_VALIDATION_CACHE).forEach(key => delete URL_VALIDATION_CACHE[key]);
            
            console.log('‚úÖ Cache limpo! Recarregue a p√°gina para usar as URLs do c√≥digo-fonte.');
            showToast('‚úÖ Cache limpo! Recarregando...', 'success');
            
            // Recarrega a p√°gina
            setTimeout(() => {
                window.location.reload(true);
            }, 1000);
        }
        
        // ===========================================
        // INICIALIZA√á√ÉO - Carrega dados salvos do localStorage
        // ===========================================
        (function initializeFromStorage() {
            // Tenta carregar projectsData salvo do localStorage
            const savedProjects = loadProjectsFromStorage();
            if (savedProjects && Array.isArray(savedProjects)) {
                // IMPORTANTE: S√≥ usa dados do localStorage se a URL no c√≥digo estiver VAZIA
                // Isso evita que URLs antigas do localStorage sobrescrevam URLs corretas do c√≥digo
                savedProjects.forEach(savedClient => {
                    const currentClient = projectsData.find(c => c.company === savedClient.company);
                    if (currentClient) {
                        savedClient.projects.forEach(savedProject => {
                            const currentProject = currentClient.projects.find(p => p.name === savedProject.name);
                            // S√≥ usa localStorage se o c√≥digo n√£o definiu uma liveUrl
                            if (currentProject && (!currentProject.liveUrl || currentProject.liveUrl.trim() === '')) {
                                if (savedProject.liveUrl) {
                                    currentProject.liveUrl = savedProject.liveUrl;
                                    console.log(`üì• URL restaurada do cache: ${currentProject.name} ‚Üí ${savedProject.liveUrl}`);
                                }
                            }
                        });
                    }
                });
                console.log('‚úÖ Dados do localStorage verificados (URLs do c√≥digo t√™m prioridade)');
            }
            
            // Auto-preenche URLs faltantes
            autoFillMissingUrls();
            
            // For√ßa salvamento das URLs corretas do c√≥digo no localStorage
            saveProjectsToStorage(projectsData);
        })();

        let currentFilter = 'all';
        let currentView = 'grid';
        let searchTerm = '';

        // ===========================================
        // SISTEMA DE SCREENSHOT COM M√öLTIPLOS FALLBACKS E RATE LIMITING
        // ===========================================
        
        // Configura√ß√µes de rate limiting para evitar sobrecarga
        const SCREENSHOT_CONFIG = {
            maxConcurrent: 4,        // M√°ximo de requisi√ß√µes simult√¢neas
            delayBetweenBatches: 500, // Delay entre lotes (ms)
            retryDelay: 2000,        // Delay antes de tentar fallback
            lazyLoadEnabled: true,   // Ativa lazy loading
            lazyLoadThreshold: 200   // Pixels antes de carregar
        };
        
        // Fila de screenshots para processar
        let screenshotQueue = [];
        let activeScreenshots = 0;
        let screenshotStats = { loaded: 0, failed: 0, total: 0 };
        
        // Lista de servi√ßos de screenshot (em ordem de prefer√™ncia)
        const SCREENSHOT_SERVICES = [
            // 1. thum.io - Gr√°tis, r√°pido, boa qualidade (vers√£o simplificada)
            (url, width = 1200, height = 800) => `https://image.thum.io/get/width/${width}/crop/${height}/${url}`,
            
            // 2. thum.io com wait (para sites mais lentos)
            (url, width = 1200, height = 800) => `https://image.thum.io/get/width/${width}/crop/${height}/wait/2/${url}`,
            
            // 3. Screenshot via Google (sempre funciona)
            (url, width = 1200, height = 800) => `https://s.wordpress.com/mshots/v1/${encodeURIComponent(url)}?w=${width}&h=${height}`,
        ];
        
        // Cache de servi√ßos que falharam para evitar tentar novamente
        const failedServices = new Set();
        
        function getScreenshotUrl(url, serviceIndex = 0) {
            if (!url) return '';
            const finalUrl = url.startsWith('http') ? url : `https://${url}`;
            
            // Usa o primeiro servi√ßo dispon√≠vel que n√£o falhou
            const service = SCREENSHOT_SERVICES[serviceIndex] || SCREENSHOT_SERVICES[0];
            return service(finalUrl, 1200, 800);
        }
        
        function getScreenshotFallbackUrl(url) {
            if (!url) return '';
            const finalUrl = url.startsWith('http') ? url : `https://${url}`;
            // Fallback: usa o segundo servi√ßo
            return SCREENSHOT_SERVICES[1](finalUrl, 1200, 800);
        }
        
        function getScreenshotFallback2Url(url) {
            if (!url) return '';
            const finalUrl = url.startsWith('http') ? url : `https://${url}`;
            // Segundo fallback: usa o terceiro servi√ßo
            return SCREENSHOT_SERVICES[2](finalUrl, 1200, 800);
        }
        
        function getListScreenshotUrl(url) {
            if (!url) return '';
            const finalUrl = url.startsWith('http') ? url : `https://${url}`;
            return SCREENSHOT_SERVICES[0](finalUrl, 600, 400);
        }
        
        function getListScreenshotFallbackUrl(url) {
            if (!url) return '';
            const finalUrl = url.startsWith('http') ? url : `https://${url}`;
            return SCREENSHOT_SERVICES[1](finalUrl, 600, 400);
        }
        
        // Sistema de processamento de fila com rate limiting
        async function processScreenshotQueue() {
            if (screenshotQueue.length === 0 || activeScreenshots >= SCREENSHOT_CONFIG.maxConcurrent) {
                return;
            }
            
            const batch = screenshotQueue.splice(0, SCREENSHOT_CONFIG.maxConcurrent - activeScreenshots);
            
            for (const item of batch) {
                activeScreenshots++;
                
                // Carrega a imagem diretamente (n√£o usar loadScreenshotWithFallback ainda)
                const img = item.img;
                const url = item.url;
                const finalUrl = url.startsWith('http') ? url : `https://${url}`;
                const isSmallPreview = img.closest('.list-preview');
                const width = isSmallPreview ? 600 : 1200;
                const height = isSmallPreview ? 400 : 800;
                
                // Define o src para iniciar carregamento
                img.src = SCREENSHOT_SERVICES[0](finalUrl, width, height);
                
                // Adiciona delay para pr√≥ximo item
                await new Promise(resolve => setTimeout(resolve, 150));
                
                activeScreenshots--;
                
                // Processa pr√≥ximo lote se houver
                if (screenshotQueue.length > 0) {
                    processScreenshotQueue();
                }
            }
        }
        
        // Carrega screenshot com fallback autom√°tico
        async function loadScreenshotWithFallback(img, url) {
            let attempts = 0;
            const maxAttempts = SCREENSHOT_SERVICES.length;
            
            while (attempts < maxAttempts) {
                try {
                    const screenshotUrl = getScreenshotUrl(url, attempts);
                    
                    // Cria uma promise para aguardar o carregamento
                    await new Promise((resolve, reject) => {
                        const tempImg = new Image();
                        
                        tempImg.onload = () => {
                            img.src = screenshotUrl;
                            screenshotStats.loaded++;
                            console.log(`‚úÖ Screenshot carregado (${screenshotStats.loaded}/${screenshotStats.total}): ${url}`);
                            resolve();
                        };
                        
                        tempImg.onerror = () => {
                            reject(new Error('Failed to load'));
                        };
                        
                        // Define timeout
                        setTimeout(() => reject(new Error('Timeout')), 10000);
                        
                        tempImg.src = screenshotUrl;
                    });
                    
                    // Sucesso - sai do loop
                    return;
                    
                } catch (error) {
                    attempts++;
                    console.log(`‚ö†Ô∏è Tentativa ${attempts} falhou para: ${url}`);
                    
                    if (attempts < maxAttempts) {
                        // Aguarda antes de tentar pr√≥ximo servi√ßo
                        await new Promise(resolve => setTimeout(resolve, SCREENSHOT_CONFIG.retryDelay));
                    } else {
                        // Todas as tentativas falharam
                        screenshotStats.failed++;
                        console.error(`‚ùå Falha ao carregar screenshot (${screenshotStats.failed}): ${url}`);
                    }
                }
            }
        }

        // Fun√ß√£o para validar se a URL √© v√°lida para screenshot
        function isValidUrl(url) {
            if (!url || url === '' || url === '#') return false;
            try {
                const parsed = new URL(url.startsWith('http') ? url : `https://${url}`);
                return parsed.hostname && parsed.hostname !== '';
            } catch {
                return false;
            }
        }
        
        // Fun√ß√£o para validar consist√™ncia entre nome do projeto e URL
        function validateProjectUrl(projectName, projectPath, liveUrl) {
            if (!liveUrl) return { valid: true };
            
            // Extrai palavras-chave do nome/path do projeto
            const projectKeywords = (projectName + ' ' + projectPath)
                .toLowerCase()
                .replace(/[^a-z0-9√°√©√≠√≥√∫√†√®√¨√≤√π√¢√™√Æ√¥√ª√£√µ√ß\s-]/g, '')
                .split(/[\s-]+/)
                .filter(w => w.length > 2);
            
            // Extrai palavras da URL
            const urlKeywords = liveUrl
                .toLowerCase()
                .replace(/https?:\/\//g, '')
                .replace(/[^a-z0-9√°√©√≠√≥√∫√†√®√¨√≤√π√¢√™√Æ√¥√ª√£√µ√ß\s-]/g, ' ')
                .split(/[\s-]+/)
                .filter(w => w.length > 2);
            
            // Verifica se h√° pelo menos uma palavra em comum
            const hasMatch = projectKeywords.some(pk => 
                urlKeywords.some(uk => uk.includes(pk) || pk.includes(uk))
            );
            
            if (!hasMatch) {
                console.warn(`‚ö†Ô∏è Poss√≠vel inconsist√™ncia: "${projectName}" ‚Üî "${liveUrl}"`);
                return { valid: false, warning: `URL pode n√£o corresponder ao projeto` };
            }
            
            return { valid: true };
        }

        // Fun√ß√£o para detectar se imagem est√° em branco/inv√°lida
        function checkImageValidity(img) {
            // Verifica dimens√µes m√≠nimas
            if (img.naturalWidth < 50 || img.naturalHeight < 50) {
                return false;
            }
            return true;
        }

        // Fun√ß√£o para lidar com erro de carregamento de imagem
        // Agora usa o sistema de fila com rate limiting
        function handleImageError(img) {
            const url = img.dataset.url;
            
            // Valida URL antes de tentar
            if (!isValidUrl(url)) {
                console.log(`‚ùå URL inv√°lida: ${url}`);
                showPreviewFallback(img, url);
                return;
            }
            
            let fallbackIndex = parseInt(img.dataset.fallbackIndex || '0') + 1;
            
            if (fallbackIndex < SCREENSHOT_SERVICES.length) {
                // Tenta o pr√≥ximo servi√ßo (sem adicionar √† fila, carrega diretamente)
                console.log(`‚ö†Ô∏è Erro ao carregar. Tentando servi√ßo ${fallbackIndex + 1}/${SCREENSHOT_SERVICES.length}...`);
                img.dataset.fallbackIndex = fallbackIndex;
                const finalUrl = url.startsWith('http') ? url : `https://${url}`;
                const isSmallPreview = img.closest('.list-preview');
                const width = isSmallPreview ? 600 : 1200;
                const height = isSmallPreview ? 400 : 800;
                
                // Adiciona delay para n√£o sobrecarregar
                setTimeout(() => {
                    img.src = SCREENSHOT_SERVICES[fallbackIndex](finalUrl, width, height);
                }, 300);
            } else {
                // Todos os servi√ßos falharam
                showPreviewFallback(img, url);
            }
        }
        
        // Mostra fallback quando preview n√£o est√° dispon√≠vel
        function showPreviewFallback(img, url) {
            console.log(`‚ùå Todos os servi√ßos falharam para: ${url}`);
            
            // Esconde a imagem quebrada
            img.style.display = 'none';
            
            // Cria placeholder visual
            const parent = img.parentElement;
            if (parent && !parent.querySelector('.preview-fallback')) {
                const fallbackDiv = document.createElement('div');
                fallbackDiv.className = 'preview-fallback';
                const safeUrl = url ? url.replace(/'/g, "\\'") : '';
                fallbackDiv.innerHTML = `
                    <i class="fas fa-globe"></i>
                    <span>Preview n√£o dispon√≠vel</span>
                    <button onclick="retryScreenshot(this, '${safeUrl}')" class="retry-btn">
                        <i class="fas fa-redo"></i> Tentar novamente
                    </button>
                `;
                parent.appendChild(fallbackDiv);
            }
        }
        
        // Verifica imagem ap√≥s carregar - detecta imagens em branco
        function handleImageLoad(img) {
            // D√° um tempo para a imagem renderizar completamente
            setTimeout(() => {
                if (!checkImageValidity(img)) {
                    console.log(`‚ö†Ô∏è Imagem carregou mas parece inv√°lida/branca: ${img.dataset.url}`);
                    // Tenta pr√≥ximo servi√ßo
                    handleImageError(img);
                }
            }, 500);
        }
        
        // Fun√ß√£o para tentar recarregar o screenshot
        function retryScreenshot(btn, url) {
            const parent = btn.closest('.project-preview, .list-preview');
            if (!parent) return;
            
            // Remove o fallback
            const fallback = parent.querySelector('.preview-fallback');
            if (fallback) fallback.remove();
            
            // Recria a imagem
            const isSmallPreview = parent.classList.contains('list-preview');
            const width = isSmallPreview ? 600 : 1200;
            const height = isSmallPreview ? 400 : 800;
            
            const img = document.createElement('img');
            img.alt = 'Preview';
            img.loading = 'lazy';
            img.dataset.url = url;
            img.dataset.fallbackIndex = '0';
            img.onerror = function() { handleImageError(this); };
            
            const finalUrl = url.startsWith('http') ? url : `https://${url}`;
            img.src = SCREENSHOT_SERVICES[0](finalUrl, width, height);
            
            parent.appendChild(img);
        }

        // Fun√ß√£o para refresh imediato do preview do card (com auto-corre√ß√£o de URL)
        async function refreshPreview(btn, url) {
            // Impede propaga√ß√£o do evento
            event.stopPropagation();
            
            const card = btn.closest('.project-card');
            const preview = card?.querySelector('.project-preview');
            const img = preview?.querySelector('img');
            
            if (!url || !isValidUrl(url)) {
                showToast('URL inv√°lida para preview', 'error');
                return;
            }
            
            if (!img) return;
            
            // Ativa anima√ß√£o do bot√£o
            btn.classList.add('refreshing');
            showToast('üîç Verificando e validando URL...', 'info');
            
            try {
                // VALIDA E CORRIGE A URL AUTOMATICAMENTE
                const validation = await validateAndFixUrl(url);
                let finalUrl = validation.url;
                
                if (validation.corrected) {
                    console.log(`üîÑ URL auto-corrigida: ${url} ‚Üí ${finalUrl}`);
                    showToast(`‚úÖ URL corrigida: ${validation.cname}`, 'success');
                    
                    // Atualiza a URL no data-attribute do bot√£o para futuras chamadas
                    btn.setAttribute('onclick', `refreshPreview(this, '${finalUrl}')`);
                    
                    // Atualiza tamb√©m no projectsData
                    updateProjectUrl(url, finalUrl);
                }
                
                if (!finalUrl.startsWith('http')) {
                    finalUrl = 'https://' + finalUrl;
                }
                
                // Remove fallback se existir
                const fallback = preview.querySelector('.preview-fallback');
                if (fallback) {
                    fallback.remove();
                    img.style.display = '';
                }
                
                // Reset do fallback index
                img.dataset.fallbackIndex = '0';
                img.dataset.url = finalUrl;
                
                // Gera nova URL com cache-buster
                const timestamp = Date.now();
                const newSrc = SCREENSHOT_SERVICES[0](finalUrl, 1200, 800) + '&t=' + timestamp;
                
                // Carrega nova imagem
                const tempImg = new Image();
                tempImg.onload = function() {
                    img.src = newSrc;
                    btn.classList.remove('refreshing');
                    showToast('‚úÖ Preview atualizado!', 'success');
                };
                tempImg.onerror = function() {
                    // Tenta pr√≥ximo servi√ßo
                    const newSrc2 = SCREENSHOT_SERVICES[1](finalUrl, 1200, 800) + '&t=' + timestamp;
                    img.dataset.fallbackIndex = '1';
                    img.src = newSrc2;
                    btn.classList.remove('refreshing');
                };
                tempImg.src = newSrc;
                
            } catch (error) {
                console.error('Erro ao validar URL:', error);
                btn.classList.remove('refreshing');
                showToast('‚ö†Ô∏è Erro ao validar URL', 'error');
            }
            
            // Timeout de seguran√ßa
            setTimeout(() => {
                btn.classList.remove('refreshing');
            }, 10000);
        }
        
        // Fun√ß√£o auxiliar para atualizar URL do projeto no projectsData
        function updateProjectUrl(oldUrl, newUrl) {
            if (oldUrl === newUrl) return;
            
            for (const client of projectsData) {
                for (const project of client.projects) {
                    // Normaliza URLs para compara√ß√£o
                    const normalizedOld = oldUrl.replace(/\/$/, '').toLowerCase();
                    const projectUrl = (project.liveUrl || '').replace(/\/$/, '').toLowerCase();
                    
                    if (projectUrl === normalizedOld || decodeURIComponent(projectUrl) === decodeURIComponent(normalizedOld)) {
                        project.liveUrl = newUrl;
                        console.log(`üìù Projeto "${project.name}" atualizado: ${newUrl}`);
                        saveProjectsToStorage(projectsData);
                        return true;
                    }
                }
            }
            return false;
        }

        // Fun√ß√£o para refresh do preview na visualiza√ß√£o em lista (com auto-corre√ß√£o de URL)
        async function refreshPreviewList(btn, url) {
            // Impede propaga√ß√£o do evento
            event.stopPropagation();
            
            const listItem = btn.closest('.list-item');
            const preview = listItem?.querySelector('.list-preview');
            const img = preview?.querySelector('img');
            
            if (!url || !isValidUrl(url)) {
                showToast('URL inv√°lida para preview', 'error');
                return;
            }
            
            if (!img) return;
            
            // Ativa anima√ß√£o do bot√£o
            btn.classList.add('refreshing');
            
            try {
                // VALIDA E CORRIGE A URL AUTOMATICAMENTE
                const validation = await validateAndFixUrl(url);
                let finalUrl = validation.url;
                
                if (validation.corrected) {
                    console.log(`üîÑ URL auto-corrigida: ${url} ‚Üí ${finalUrl}`);
                    showToast(`‚úÖ URL corrigida: ${validation.cname}`, 'success');
                    btn.setAttribute('onclick', `refreshPreviewList(this, '${finalUrl}')`);
                    updateProjectUrl(url, finalUrl);
                }
                
                if (!finalUrl.startsWith('http')) {
                    finalUrl = 'https://' + finalUrl;
                }
                
                // Remove fallback se existir
                const fallback = preview.querySelector('.preview-fallback');
                if (fallback) {
                    fallback.remove();
                    img.style.display = '';
                }
                
                // Reset do fallback index
                img.dataset.fallbackIndex = '0';
                img.dataset.url = finalUrl;
                
                // Gera nova URL com cache-buster (tamanho menor para lista)
                const timestamp = Date.now();
                const newSrc = SCREENSHOT_SERVICES[0](finalUrl, 600, 400) + '&t=' + timestamp;
                
                // Carrega nova imagem
                const tempImg = new Image();
                tempImg.onload = function() {
                    img.src = newSrc;
                    btn.classList.remove('refreshing');
                };
                tempImg.onerror = function() {
                    const newSrc2 = SCREENSHOT_SERVICES[1](finalUrl, 600, 400) + '&t=' + timestamp;
                    img.dataset.fallbackIndex = '1';
                    img.src = newSrc2;
                    btn.classList.remove('refreshing');
                };
                tempImg.src = newSrc;
                
            } catch (error) {
                console.error('Erro ao validar URL:', error);
                btn.classList.remove('refreshing');
                showToast('‚ö†Ô∏è Erro ao validar URL', 'error');
            }
            
            // Timeout de seguran√ßa
            setTimeout(() => {
                btn.classList.remove('refreshing');
            }, 10000);
        }

        function getPlaceholderPreview(name) {
            // Placeholder com cor baseada no nome
            const colors = [
                'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)'
            ];
            const index = name.length % colors.length;
            return colors[index];
        }

        function renderProjects() {
            const container = document.getElementById('projectsContainer');
            container.innerHTML = '';
            
            let totalProjects = 0;
            let productionCount = 0;
            let clientsRendered = 0;
            let anyProjectsShown = false;

            projectsData.forEach(client => {
                const filteredProjects = client.projects.filter(project => {
                    const matchesSearch = !searchTerm || 
                        project.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        client.company.toLowerCase().includes(searchTerm.toLowerCase());
                    const matchesFilter = currentFilter === 'all' || project.status === currentFilter;
                    return matchesSearch && matchesFilter;
                });

                if (filteredProjects.length === 0) return;
                anyProjectsShown = true;
                clientsRendered++;
                
                totalProjects += filteredProjects.length;
                productionCount += filteredProjects.filter(p => p.status === 'production').length;

                const section = document.createElement('div');
                section.className = 'client-section';
                section.innerHTML = `
                    <div class="client-header">
                        <div class="client-icon">${client.companyIcon}</div>
                        <div class="client-info">
                            <h2>${client.company}</h2>
                            <p>${client.description}</p>
                        </div>
                        <div class="project-count">${filteredProjects.length} projeto${filteredProjects.length > 1 ? 's' : ''}</div>
                    </div>
                    <div class="projects-grid ${currentView === 'list' ? 'hidden' : ''}">
                        ${filteredProjects.map(project => {
                            const publicUrl = getPublicUrl(project.liveUrl);
                            const isCustomDomain = hasCustomDomain(project.liveUrl);
                            
                            // IMPORTANTE: Usar publicUrl (dom√≠nio personalizado) para screenshots
                            const screenshotTargetUrl = publicUrl || project.liveUrl;
                            
                            // DEBUG: Log para verificar URLs
                            if (project.liveUrl) {
                                const screenshotUrl = getScreenshotUrl(screenshotTargetUrl);
                                console.log(`üì∏ ${project.name}:`);
                                console.log(`   liveUrl: ${project.liveUrl}`);
                                console.log(`   publicUrl: ${publicUrl}`);
                                console.log(`   isCustomDomain: ${isCustomDomain}`);
                                console.log(`   href usado no link: ${publicUrl || '#'}`);
                                console.log(`   screenshotTargetUrl: ${screenshotTargetUrl}`);
                            }
                            
                            // Valida√ß√£o de consist√™ncia URL vs Nome
                            const urlValidation = validateProjectUrl(project.name, project.path, publicUrl);
                            const hasWarning = !urlValidation.valid;
                            
                            return `
                            <div class="project-card ${hasWarning ? 'url-warning' : ''}">
                                <div class="project-preview" style="background: ${getPlaceholderPreview(project.name)}">
                                    ${hasWarning ? `<span class="warning-badge" title="${urlValidation.warning}">‚ö†Ô∏è</span>` : ''}
                                    ${project.liveUrl && isValidUrl(screenshotTargetUrl) ? `
                                        <button class="refresh-preview-btn" onclick="refreshPreview(this, '${screenshotTargetUrl}')" title="Atualizar preview">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                        <img data-src="${getScreenshotUrl(screenshotTargetUrl)}" 
                                             alt="${project.name}" 
                                             loading="lazy"
                                             class="lazy-screenshot"
                                             data-url="${screenshotTargetUrl}"
                                             data-fallback-index="0"
                                             onload="handleImageLoad(this)"
                                             onerror="handleImageError(this)">
                                    ` : `
                                        <div class="loading">
                                            <i class="fas fa-image"></i>
                                            <span>${project.liveUrl ? 'URL inv√°lida' : 'Preview Local'}</span>
                                        </div>
                                    `}
                                    <div class="preview-overlay">
                                        <a href="${project.localUrl}" class="preview-btn" title="Ver preview local" target="_blank">
                                            <i class="fas fa-desktop"></i>
                                        </a>
                                        ${project.liveUrl ? `
                                            <a href="${publicUrl}" class="preview-btn" title="Abrir site ao vivo: ${isCustomDomain ? publicUrl : 'GitHub Pages'}" target="_blank">
                                                <i class="fas fa-${isCustomDomain ? 'star' : 'globe'}"></i>
                                            </a>
                                        ` : ''}
                                        <button class="preview-btn" onclick="openModal('${publicUrl || project.localUrl}', '${project.name}')" title="Preview em modal">
                                            <i class="fas fa-expand"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="project-content">
                                    <div class="project-name">
                                        ${project.name}
                                        <span class="status-badge status-${project.status}">
                                            ${project.status === 'production' ? '‚óè Produ√ß√£o' : '‚óã Ativo'}
                                        </span>
                                    </div>
                                    <div class="project-path">
                                        <i class="fas fa-folder"></i>
                                        ${project.path}
                                    </div>
                                    <div class="project-links">
                                        <a href="${project.localUrl}" class="project-link" target="_blank" title="Preview local do projeto">
                                            <i class="fas fa-file-code"></i> Local
                                        </a>
                                        <a href="${publicUrl || '#'}" class="project-link ${!project.liveUrl ? 'disabled' : ''}" target="_blank" title="${project.liveUrl ? (isCustomDomain ? `Abrir em: ${publicUrl}` : `Site ao Vivo`) : 'URL n√£o dispon√≠vel'}">
                                            <i class="fas fa-${isCustomDomain ? 'star' : 'globe'}"></i> ${isCustomDomain ? 'Site Ao Vivo ‚≠ê' : 'Site Ao Vivo'}
                                        </a>
                                    </div>
                                </div>
                            </div>
                        `}).join('')}
                    </div>
                    <div class="projects-list ${currentView === 'grid' ? '' : 'active'}">
                        ${filteredProjects.map(project => {
                            const publicUrl = getPublicUrl(project.liveUrl);
                            const isCustomDomain = hasCustomDomain(project.liveUrl);
                            // IMPORTANTE: Usar publicUrl (dom√≠nio personalizado) para screenshots na lista
                            const listScreenshotTargetUrl = publicUrl || project.liveUrl;
                            return `
                            <div class="list-item">
                                <div class="list-preview" style="background: ${getPlaceholderPreview(project.name)}">
                                    ${project.liveUrl && isValidUrl(listScreenshotTargetUrl) ? `
                                        <button class="refresh-preview-btn" onclick="refreshPreviewList(this, '${listScreenshotTargetUrl}')" title="Atualizar preview">
                                            <i class="fas fa-sync-alt"></i>
                                        </button>
                                        <img src="${getListScreenshotUrl(listScreenshotTargetUrl)}" 
                                             alt="${project.name}" 
                                             loading="lazy"
                                             data-url="${listScreenshotTargetUrl}"
                                             data-fallback-index="0"
                                             onload="handleImageLoad(this)"
                                             onerror="handleImageError(this)">
                                    ` : ''}
                                </div>
                                <div class="list-info">
                                    <h4>
                                        ${project.name} 
                                        <span class="status-badge status-${project.status}">${project.status === 'production' ? 'Produ√ß√£o' : 'Ativo'}</span>
                                        ${isCustomDomain ? '<span style="color: #f59e0b; margin-left: 8px;" title="Com dom√≠nio personalizado">‚≠ê</span>' : ''}
                                    </h4>
                                    <p><i class="fas fa-folder"></i> ${project.path}</p>
                                </div>
                                <div class="list-actions">
                                    <a href="${project.localUrl}" target="_blank" title="Preview local"><i class="fas fa-file-code"></i> Local</a>
                                    ${project.liveUrl ? `<a href="${publicUrl}" target="_blank" title="${isCustomDomain ? `Abrir em: ${publicUrl}` : 'Site ao Vivo'}"><i class="fas fa-${isCustomDomain ? 'star' : 'globe'}"></i> ${isCustomDomain ? 'Site Ao Vivo' : 'Site Ao Vivo'}</a>` : ''}
                                </div>
                            </div>
                        `}).join('')}
                    </div>
                `;
                container.appendChild(section);
            });

            document.getElementById('totalClients').textContent = clientsRendered;
            document.getElementById('totalProjects').textContent = totalProjects;
            document.getElementById('productionCount').textContent = productionCount;
            document.getElementById('noResults').style.display = anyProjectsShown ? 'none' : 'block';
            
            // Ativa lazy loading com Intersection Observer
            initLazyLoading();
        }
        
        // Intersection Observer para lazy loading progressivo
        let imageObserver = null;
        
        function initLazyLoading() {
            // Remove observer anterior se existir
            if (imageObserver) {
                imageObserver.disconnect();
            }
            
            // Reseta estat√≠sticas
            screenshotStats = { loaded: 0, failed: 0, total: 0 };
            screenshotQueue = [];
            activeScreenshots = 0;
            
            // Configura√ß√£o do Intersection Observer
            const observerConfig = {
                root: null,
                rootMargin: `${SCREENSHOT_CONFIG.lazyLoadThreshold}px`,
                threshold: 0.01
            };
            
            imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        const dataSrc = img.getAttribute('data-src');
                        
                        if (dataSrc && !img.src) {
                            // Adiciona √† fila em vez de carregar imediatamente
                            screenshotQueue.push({ img, url: img.dataset.url });
                            screenshotStats.total++;
                            
                            // Remove o data-src para n√£o processar novamente
                            img.removeAttribute('data-src');
                            
                            // Inicia processamento da fila
                            processScreenshotQueue();
                        }
                        
                        // Para de observar esta imagem
                        observer.unobserve(img);
                    }
                });
            }, observerConfig);
            
            // Observa todas as imagens lazy
            const lazyImages = document.querySelectorAll('img.lazy-screenshot[data-src]');
            console.log(`üñºÔ∏è Lazy loading habilitado para ${lazyImages.length} imagens`);
            
            lazyImages.forEach(img => {
                imageObserver.observe(img);
            });
            
            // Se n√£o h√° lazy loading, mostra estat√≠sticas
            if (lazyImages.length === 0) {
                const allImages = document.querySelectorAll('.project-preview img, .list-preview img');
                console.log(`üìä Total de previews: ${allImages.length}`);
            }
        }

        function setView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.view-btn').classList.add('active');
            renderProjects();
        }

        function filterStatus(status) {
            currentFilter = status;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderProjects();
        }

        function openModal(url, title) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('previewFrame').src = url;
            document.getElementById('previewModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('previewModal').classList.remove('active');
            document.getElementById('previewFrame').src = '';
        }
        
        async function refreshPreviews() {
            const btn = event.target.closest('.refresh-btn');
            btn.classList.add('refreshing');
            btn.disabled = true;
            
            showToast('üîß Validando e corrigindo URLs...', 'info');
            
            // ETAPA 1: Auto-corrige URLs quebradas (s√≥ github.io)
            const fixResult = await autoFixAllUrls();
            if (fixResult.corrected > 0) {
                showToast(`‚úÖ ${fixResult.corrected} URLs corrigidas!`, 'success');
                // Re-renderiza para usar as novas URLs
                renderProjects();
                // Aguarda renderiza√ß√£o
                await new Promise(r => setTimeout(r, 500));
            }
            
            // Re-busca imagens ap√≥s poss√≠vel re-render
            const allImages = document.querySelectorAll('.project-preview img, .list-preview img');
            
            // Remove todos os fallbacks existentes
            document.querySelectorAll('.preview-fallback').forEach(fb => fb.remove());
            
            let loadedCount = 0;
            let successCount = 0;
            const totalImages = allImages.length;
            
            if (totalImages === 0) {
                finishRefresh();
                return;
            }
            
            allImages.forEach(img => {
                // Mostra a imagem novamente se estava escondida
                img.style.display = '';
                
                // Reset do √≠ndice de fallback
                img.dataset.fallbackIndex = '0';
                
                const url = img.dataset.url;
                if (!url || !isValidUrl(url)) {
                    loadedCount++;
                    if (loadedCount === totalImages) finishRefresh();
                    return;
                }
                
                // Gera nova URL para screenshot
                const finalUrl = url.startsWith('http') ? url : `https://${url}`;
                const isSmallPreview = img.closest('.list-preview');
                const width = isSmallPreview ? 600 : 1200;
                const height = isSmallPreview ? 400 : 800;
                
                // Usa thum.io diretamente (sem cache buster na URL do site)
                const newSrc = SCREENSHOT_SERVICES[0](finalUrl, width, height);
                
                const newImg = new Image();
                
                newImg.onload = () => {
                    img.src = newSrc;
                    successCount++;
                    loadedCount++;
                    if (loadedCount === totalImages) {
                        finishRefresh();
                    }
                };
                
                newImg.onerror = () => {
                    // Tenta servi√ßo secund√°rio
                    const fallbackSrc = SCREENSHOT_SERVICES[1](finalUrl, width, height);
                    const fallbackImg = new Image();
                    fallbackImg.onload = () => {
                        img.src = fallbackSrc;
                        successCount++;
                        loadedCount++;
                        img.dataset.fallbackIndex = '1';
                        if (loadedCount === totalImages) finishRefresh();
                    };
                    fallbackImg.onerror = () => {
                        // Tenta terceiro servi√ßo (WordPress mshots)
                        const fallback2Src = SCREENSHOT_SERVICES[2](finalUrl, width, height);
                        img.src = fallback2Src;
                        img.dataset.fallbackIndex = '2';
                        loadedCount++;
                        if (loadedCount === totalImages) finishRefresh();
                    };
                    fallbackImg.src = fallbackSrc;
                };
                
                newImg.src = newSrc;
            });
            
            function finishRefresh() {
                setTimeout(() => {
                    btn.classList.remove('refreshing');
                    btn.disabled = false;
                    
                    // Atualiza data de atualiza√ß√£o
                    document.getElementById('updateDate').textContent = new Date().toLocaleDateString('pt-BR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    showToast(`‚úÖ ${successCount}/${totalImages} previews atualizados!`, 'success');
                }, 500);
            }
        }
        
        // Fun√ß√£o para mostrar notifica√ß√£o
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            const icon = toast.querySelector('i');
            
            // Remove classes anteriores
            toast.classList.remove('success', 'error', 'info', 'show');
            
            // Define √≠cone baseado no tipo
            icon.className = '';
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
                toast.classList.add('success');
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
                toast.classList.add('error');
            } else {
                icon.className = 'fas fa-info-circle';
                toast.classList.add('info');
            }
            
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            // Auto-esconder ap√≥s 5 segundos
            setTimeout(() => {
                toast.classList.remove('show');
            }, 5000);
        }
        
        // Fun√ß√£o para buscar TODOS os reposit√≥rios p√∫blicos do GitHub
        async function fetchAllGitHubRepos() {
            const allRepos = [];
            let page = 1;
            const perPage = 100;
            
            try {
                while (true) {
                    const response = await fetch(
                        `https://api.github.com/users/${GITHUB_USERNAME}/repos?per_page=${perPage}&page=${page}&type=public`,
                        {
                            headers: {
                                'Accept': 'application/vnd.github.v3+json'
                            }
                        }
                    );
                    
                    if (!response.ok) {
                        console.warn(`‚ö†Ô∏è Erro ao buscar reposit√≥rios (p√°gina ${page}):`, response.status);
                        break;
                    }
                    
                    const repos = await response.json();
                    
                    if (repos.length === 0) {
                        break; // N√£o h√° mais reposit√≥rios
                    }
                    
                    // Adiciona apenas repos com GitHub Pages habilitado
                    repos.forEach(repo => {
                        if (repo.has_pages) {
                            allRepos.push({
                                name: repo.name,
                                fullName: repo.full_name,
                                homepage: repo.homepage,
                                hasPages: repo.has_pages,
                                description: repo.description
                            });
                        }
                    });
                    
                    if (repos.length < perPage) {
                        break; // √öltima p√°gina
                    }
                    
                    page++;
                }
                
                console.log(`üì¶ Total de reposit√≥rios com GitHub Pages: ${allRepos.length}`);
                return allRepos;
                
            } catch (error) {
                console.error('‚ùå Erro ao buscar reposit√≥rios:', error);
                showToast('‚ö†Ô∏è Usando lista local de reposit√≥rios', 'info');
                
                // Fallback para lista local
                const localRepos = new Set(KNOWN_REPOS);
                projectsData.forEach(client => {
                    client.projects.forEach(project => {
                        if (project.liveUrl && project.liveUrl.includes('github.io')) {
                            const repoMatch = project.liveUrl.match(/github\.io\/([^\/]+)/);
                            if (repoMatch && repoMatch[1]) {
                                localRepos.add(repoMatch[1]);
                            }
                        }
                    });
                });
                
                return Array.from(localRepos).map(name => ({
                    name: name,
                    fullName: `${GITHUB_USERNAME}/${name}`,
                    hasPages: true
                }));
            }
        }
        
        // Fun√ß√£o para sincronizar com GitHub (busca TODOS os reposit√≥rios p√∫blicos)
        async function syncWithGitHub() {
            const btn = document.getElementById('syncBtn');
            const icon = btn.querySelector('i');
            const span = btn.querySelector('span');
            
            btn.classList.add('syncing');
            btn.disabled = true;
            span.textContent = 'Limpando cache...';
            
            showToast('üßπ Limpando cache antigo...', 'info');
            
            try {
                // ETAPA 0: LIMPA TODO O CACHE ANTIGO
                console.log('\nüßπ ETAPA 0: Limpando cache antigo...');
                localStorage.removeItem(STORAGE_KEY_DOMAINS);
                localStorage.removeItem(STORAGE_KEY_PROJECTS);
                Object.keys(URL_VALIDATION_CACHE).forEach(key => delete URL_VALIDATION_CACHE[key]);
                console.log('‚úÖ Cache limpo!');
                
                // ETAPA 1: RECARREGA URLs DO C√ìDIGO-FONTE
                // As URLs definidas no projectsData (no c√≥digo HTML) s√£o as corretas
                // N√£o precisamos fazer nada aqui pois o c√≥digo j√° tem as URLs certas
                console.log('\nüìã ETAPA 1: Usando URLs do c√≥digo-fonte (s√£o as corretas)');
                span.textContent = 'Validando URLs...';
                
                // Log das URLs atuais para debug
                let urlCount = 0;
                projectsData.forEach(client => {
                    client.projects.forEach(project => {
                        if (project.liveUrl) {
                            console.log(`   ‚úÖ ${project.name}: ${project.liveUrl}`);
                            urlCount++;
                        }
                    });
                });
                console.log(`üìä Total: ${urlCount} URLs configuradas`);
                
                // ETAPA 2: Auto-corrige apenas URLs que usam github.io
                console.log('\nüîß ETAPA 2: Verificando URLs github.io...');
                span.textContent = 'Corrigindo URLs...';
                
                const fixResult = await autoFixAllUrls();
                if (fixResult.corrected > 0) {
                    showToast(`‚úÖ ${fixResult.corrected} URLs github.io corrigidas!`, 'success');
                }
                
                // ETAPA 2.5: Detecta e corrige URLs quebradas (subpastas inexistentes, etc)
                console.log('\nüîç ETAPA 2.5: Detectando URLs quebradas...');
                span.textContent = 'Verificando URLs...';
                
                const brokenResult = await detectAndFixBrokenUrls();
                if (brokenResult.fixed > 0) {
                    showToast(`‚úÖ ${brokenResult.fixed} URLs corrigidas!`, 'success');
                }
                if (brokenResult.broken > 0) {
                    showToast(`‚ö†Ô∏è ${brokenResult.broken} URLs n√£o publicadas detectadas`, 'warning');
                }
                
                // ETAPA 3: BUSCA REPOSIT√ìRIOS DO GITHUB (para detectar novos dom√≠nios)
                console.log('\nüåê ETAPA 3: Buscando reposit√≥rios no GitHub...');
                span.textContent = 'Buscando reposit√≥rios...';
                
                const allGitHubRepos = await fetchAllGitHubRepos();
                
                console.log('\nüåê REPOSIT√ìRIOS ENCONTRADOS NO GITHUB:');
                allGitHubRepos.forEach(repo => {
                    console.log(`  üìÅ ${repo.name}${repo.homepage ? ` ‚Üí homepage: ${repo.homepage}` : ' (sem homepage)'}`);
                });
                
                showToast(`üîç Verificando ${allGitHubRepos.length} reposit√≥rios com GitHub Pages...`, 'info');
                
                let foundCount = 0;
                let notFoundCount = 0;
                const newDomains = {};
                const notFoundRepos = [];
                
                // Verifica cada reposit√≥rio do GitHub
                for (const repo of allGitHubRepos) {
                    // Se o repo tem homepage configurado E n√£o √© github.io, usa como dom√≠nio personalizado
                    if (repo.homepage && repo.homepage.trim() !== '' && !repo.homepage.includes('github.io')) {
                        const customDomain = repo.homepage.replace(/^https?:\/\//, '').replace(/\/$/, '');
                        newDomains[repo.name] = customDomain;
                        foundCount++;
                        console.log(`‚úÖ ${repo.name} ‚Üí ${customDomain} (via homepage do GitHub)`);
                    } else {
                        // Tenta detectar dom√≠nio personalizado via CNAME ou mapeamento local
                        const customDomain = await detectCustomDomain(repo.name);
                        
                        if (customDomain) {
                            newDomains[repo.name] = customDomain;
                            foundCount++;
                            console.log(`‚úÖ ${repo.name} ‚Üí ${customDomain} (via CNAME/mapeamento)`);
                        } else {
                            notFoundRepos.push(repo.name);
                            notFoundCount++;
                        }
                    }
                }
                
                // Log de reposit√≥rios sem dom√≠nio personalizado
                if (notFoundRepos.length > 0) {
                    console.log(`\n‚ö†Ô∏è Reposit√≥rios SEM dom√≠nio personalizado (${notFoundCount}):`);
                    notFoundRepos.forEach(name => console.log(`   - ${name} (usando GitHub Pages padr√£o)`));
                }
                
                console.log(`\nüåü Total de dom√≠nios personalizados encontrados: ${foundCount}`);
                console.log('Dom√≠nios:', newDomains);
                
                // Atualiza CUSTOM_DOMAINS
                Object.keys(CUSTOM_DOMAINS).forEach(key => delete CUSTOM_DOMAINS[key]);
                Object.assign(CUSTOM_DOMAINS, newDomains);
                
                // üíæ SALVA NO LOCALSTORAGE para persistir entre reloads
                saveDomainsToStorage(CUSTOM_DOMAINS);
                
                // ATUALIZA OS projectsData com os novos dom√≠nios
                const updatedProjects = updateProjectsDataWithDomains(newDomains);
                
                // üíæ SALVA projectsData atualizado no localStorage
                saveProjectsToStorage(projectsData);
                
                // Resumo final
                const totalFixed = (fixResult?.corrected || 0) + (brokenResult?.fixed || 0) + updatedProjects;
                const totalBroken = brokenResult?.broken || 0;
                
                console.log('\nüìä RESUMO DA SINCRONIZA√á√ÉO:');
                console.log(`   ‚úÖ URLs github.io corrigidas: ${fixResult?.corrected || 0}`);
                console.log(`   ‚úÖ URLs quebradas corrigidas: ${brokenResult?.fixed || 0}`);
                console.log(`   ‚ö†Ô∏è URLs n√£o publicadas: ${totalBroken}`);
                console.log(`   üåê Dom√≠nios personalizados: ${foundCount}`);
                console.log(`   üì¶ Projetos atualizados: ${updatedProjects}`);
                
                if (totalFixed > 0) {
                    showToast(`‚úÖ ${totalFixed} projetos corrigidos/atualizados!`, 'success');
                } else if (foundCount > 0) {
                    showToast(`‚ÑπÔ∏è ${foundCount} dom√≠nios encontrados. Todos j√° estavam corretos.`, 'info');
                } else {
                    showToast(`‚ÑπÔ∏è Nenhuma atualiza√ß√£o necess√°ria.`, 'info');
                }
                
                // RE-RENDERIZA COMPLETAMENTE o dashboard para criar novos elementos com URLs atualizadas
                console.log('\nüé® Re-renderizando dashboard com URLs atualizadas...');
                renderProjects();
                
                // Pequeno delay para garantir que o DOM foi atualizado
                setTimeout(() => {
                    showToast('‚úÖ Dashboard atualizado! Previews usar√£o dom√≠nios corretos.', 'success');
                }, 500);
                
                // Atualiza data
                document.getElementById('updateDate').textContent = new Date().toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
            } catch (error) {
                console.error('Erro ao sincronizar:', error);
                showToast(`‚ö†Ô∏è Erro: ${error.message}`, 'error');
            } finally {
                btn.classList.remove('syncing');
                btn.disabled = false;
                span.textContent = 'Atualizar Links';
            }
        }
        
        // Fun√ß√£o para atualizar projectsData com os dom√≠nios encontrados
        function updateProjectsDataWithDomains(domains) {
            let updatedCount = 0;
            
            console.log('üîç Iniciando vincula√ß√£o de dom√≠nios personalizados...');
            console.log('üì¶ Dom√≠nios encontrados:', Object.keys(domains).length);
            
            // Percorre todos os clientes e projetos
            projectsData.forEach(client => {
                client.projects.forEach(project => {
                    // Se o projeto tem liveUrl (tanto github.io quanto dom√≠nio personalizado)
                    if (project.liveUrl) {
                        let currentRepo = null;
                        let currentSubPath = '';
                        
                        // Extrai o reposit√≥rio de URLs do GitHub Pages
                        if (project.liveUrl.includes('github.io')) {
                            const urlParts = project.liveUrl.replace(/^https?:\/\/[^\/]+\//, '');
                            const pathParts = urlParts.split('/');
                            currentRepo = pathParts[0];
                            currentSubPath = pathParts.slice(1).join('/');
                        }
                        
                        if (currentRepo && domains[currentRepo]) {
                            const customDomain = domains[currentRepo];
                            const newUrl = currentSubPath 
                                ? `https://${customDomain}/${currentSubPath}`
                                : `https://${customDomain}`;
                            
                            // Atualiza a URL do projeto
                            if (project.liveUrl !== newUrl) {
                                console.log(`\n‚úÖ ATUALIZADO:`);
                                console.log(`   Cliente: ${client.company}`);
                                console.log(`   Projeto: ${project.name}`);
                                console.log(`   üîó Antes: ${project.liveUrl}`);
                                console.log(`   üåü Depois: ${newUrl}`);
                                project.liveUrl = newUrl;
                                updatedCount++;
                            }
                        }
                    }
                });
            });
            
            console.log(`\n‚ú® RESUMO: ${updatedCount} projetos vinculados a dom√≠nios personalizados`);
            return updatedCount;
        }
        
        // Fun√ß√£o auxiliar para detectar dom√≠nio personalizado
        async function detectCustomDomain(repo) {
            try {
                // Primeiro tenta o mapeamento conhecido (mais r√°pido e completo)
                const knownDomains = {
                    // Banca Pacheco
                    '05-lp-queijos-frios': 'lp.bancapacheco.com.br',
                    '06-link-bio-banca-pacheco': 'links.bancapacheco.com.br',
                    
                    // WOLF Carpentry
                    'BATHROOM-REMODELING-WOLF': 'bathroom.wolfcarpenters.com',
                    'KITCHEN-REMODELING-WOLF': 'kitchen.wolfcarpenters.com',
                    'ADU-HOMEADDITION': 'additions.wolfcarpenters.com',
                    
                    // INNOV Builders USA
                    'CUSTOM-BUILT-INS-INNOV': 'built-ins.innovbuildersusa.com',
                    'KITCHEN-REMODELING-INNOV': 'kitchen.innovbuildersusa.com',
                    'PAINTING': 'painting.innovbuildersusa.com',
                    'STAIR-REMODELING-INNOV': 'stairs.innovbuildersusa.com',
                    
                    // PROTEC
                    'LP-PROTEC-GRANITE-2': 'granite.protecpremiumgranite.com',
                    'LP-PROTEC-QUARTZ': 'quartz.protecpremiumgranite.com',
                    
                    // AMCC
                    'AMCC-LP': 'landingpage.grupoamcc.com.br',
                };
                
                if (knownDomains[repo]) {
                    console.log(`üìã ${repo} ‚Üí ${knownDomains[repo]} (mapeamento local)`);
                    return knownDomains[repo];
                }
                
                // Branches para tentar (em ordem de prioridade)
                const branches = ['gh-pages', 'main', 'master'];
                
                // Tenta verificar arquivo CNAME em cada branch
                for (const branch of branches) {
                    try {
                        const cnameResponse = await fetch(
                            `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${repo}/${branch}/CNAME`,
                            { method: 'GET', cache: 'no-cache' }
                        );
                        
                        if (cnameResponse.ok) {
                            const customDomain = (await cnameResponse.text()).trim();
                            if (customDomain && !customDomain.includes('github.io') && customDomain.includes('.')) {
                                console.log(`üîç CNAME detectado (${branch}): ${repo} ‚Üí ${customDomain}`);
                                return customDomain;
                            }
                        }
                    } catch (e) {
                        // Branch n√£o existe ou CNAME n√£o encontrado
                    }
                }
                
                // Se n√£o encontrou CNAME, tenta acessar a p√°gina e verificar redirecionamento
                const githubPagesUrl = `https://${GITHUB_USERNAME}.github.io/${repo}/`;
                
                try {
                    const pageResponse = await fetch(githubPagesUrl, {
                        method: 'GET',
                        mode: 'cors',
                        cache: 'no-cache'
                    });
                    
                    if (pageResponse.ok) {
                        const html = await pageResponse.text();
                        
                        // Procura por canonical URL ou meta tags que indiquem dom√≠nio personalizado
                        const canonicalMatch = html.match(/<link[^>]*rel=["']canonical["'][^>]*href=["']([^"']+)["']/i);
                        if (canonicalMatch && canonicalMatch[1] && !canonicalMatch[1].includes('github.io')) {
                            const customDomain = canonicalMatch[1].replace(/^https?:\/\//, '').replace(/\/$/, '').split('/')[0];
                            console.log(`üîç Canonical detectado: ${repo} ‚Üí ${customDomain}`);
                            return customDomain;
                        }
                    }
                } catch (pageError) {
                    // P√°gina n√£o acess√≠vel
                }
                
                return null;
                
            } catch (error) {
                console.error(`‚ùå Erro ao detectar dom√≠nio para ${repo}:`, error);
                return null;
            }
        }
        
        // Fun√ß√£o para atualizar previews ap√≥s sincroniza√ß√£o
        // IMPORTANTE: Esta fun√ß√£o √© chamada AP√ìS projectsData ser atualizado com novos dom√≠nios
        // Os screenshots agora usar√£o as URLs dos dom√≠nios personalizados
        function refreshPreviewsAfterSync() {
            console.log('\nüì∏ Iniciando atualiza√ß√£o de previews com URLs atualizadas...');
            
            const timestamp = new Date().getTime();
            const allImages = document.querySelectorAll('.project-preview img, .list-preview img');
            
            let loadedCount = 0;
            let successCount = 0;
            let errorCount = 0;
            const totalImages = allImages.length;
            
            if (totalImages === 0) {
                showToast('‚úÖ Previews atualizados!', 'success');
                return;
            }
            
            console.log(`üñºÔ∏è Total de imagens para atualizar: ${totalImages}`);
            
            allImages.forEach((img, index) => {
                // Pega a URL original do screenshot (que agora j√° est√° usando dom√≠nio personalizado)
                // Remove cache/timestamp antigo
                const currentSrc = img.src;
                const urlMatch = currentSrc.match(/url=([^&]+)/);
                
                if (urlMatch) {
                    const decodedUrl = decodeURIComponent(urlMatch[1]);
                    console.log(`  üîÑ Preview ${index + 1}: ${decodedUrl}`);
                }
                
                // For√ßa reload adicionando timestamp
                const baseSrc = currentSrc.split('&t=')[0].split('?t=')[0];
                const newSrc = baseSrc.includes('?') ? `${baseSrc}&t=${timestamp}` : `${baseSrc}?t=${timestamp}`;
                
                const newImg = new Image();
                
                newImg.onload = () => {
                    img.src = newSrc;
                    loadedCount++;
                    successCount++;
                    
                    if (loadedCount === totalImages) {
                        console.log(`‚úÖ Previews carregados: ${successCount} sucesso, ${errorCount} erros`);
                        showToast(`‚úÖ ${successCount} previews atualizados com dom√≠nios personalizados!`, 'success');
                    }
                };
                
                newImg.onerror = () => {
                    loadedCount++;
                    errorCount++;
                    console.warn(`‚ö†Ô∏è Erro ao carregar preview ${index + 1}`);
                    
                    if (loadedCount === totalImages) {
                        console.log(`‚úÖ Previews carregados: ${successCount} sucesso, ${errorCount} erros`);
                        showToast(`‚úÖ Previews atualizados! (${successCount}/${totalImages} carregados)`, 'success');
                    }
                };
                
                newImg.src = newSrc;
            });
        }

        // ===========================================
        // ESCANEAR PASTAS DO WORKSPACE
        // ===========================================
        
        // Mapeamento de pastas conhecidas para configura√ß√£o de clientes
        const FOLDER_CONFIG = {
            'AMCC': {
                icon: 'üìä',
                description: 'Contabilidade Empresarial - Crici√∫ma/SC',
                subfolders: ['LP PADR√ÉO', 'LP-EMPRESAS QUE FATURAM ACIMA DE MIL REAIS POR M√äS', 'LP-ESCOLAS-PARTICULARES- amcc', 'LP-OTICA']
            },
            'BANCA PACHECO': {
                icon: 'üßÄ',
                description: 'Emp√≥rio e Delicatessen - Crici√∫ma/SC',
                subfolders: ['02-SITE-COMPLETO-COPIA', '03-LANDING-PAGE-PROMOCOES-BANCA', '05-lp-queijos-frios', '06-link-bio', '07-TABOAS DE FRIOS']
            },
            'ENGITUNNEL': {
                icon: 'üèóÔ∏è',
                description: 'Engenharia e Consultoria - S√£o Paulo/SP',
                subfolders: ['01 - LP CONSULTORIA', '02 - LP PROJETO ARQUITETONICO', '03 - LP CONSULTORIA ENGENHARIA']
            },
            'INNOV': {
                icon: 'üî®',
                description: 'Construction & Remodeling - MA, USA',
                subfolders: ['PRONTAS']
            },
            'WOLF': {
                icon: 'ü™ö',
                description: 'Premium Carpentry - MA, USA',
                subfolders: ['BATHROOM-REMODELING', 'KITCHEN-REMODELING', 'ADU-HOME-ADDITION']
            },
            'PROTEC': {
                icon: 'üíé',
                description: 'Premium Granite & Stone - MA, USA',
                subfolders: []
            },
            'MOTEL XENON': {
                icon: 'üè®',
                description: 'Motel Tem√°tico - Crici√∫ma/SC',
                subfolders: []
            }
        };
        
        // √çcones padr√£o por tipo de neg√≥cio detectado
        const BUSINESS_ICONS = {
            'contab': 'üìä',
            'banca': 'üßÄ',
            'food': 'üçï',
            'restaurant': 'üçΩÔ∏è',
            'engi': 'üèóÔ∏è',
            'construct': 'üî®',
            'build': 'üî®',
            'carpent': 'ü™ö',
            'wood': 'ü™µ',
            'granite': 'üíé',
            'stone': 'ü™®',
            'motel': 'üè®',
            'hotel': 'üè®',
            'clinic': 'üè•',
            'dental': 'ü¶∑',
            'law': '‚öñÔ∏è',
            'legal': '‚öñÔ∏è',
            'auto': 'üöó',
            'car': 'üöó',
            'tech': 'üíª',
            'digital': 'üíª',
            'marketing': 'üìà',
            'real estate': 'üè†',
            'imobi': 'üè†'
        };
        
        function getIconForFolder(folderName) {
            const lowerName = folderName.toLowerCase();
            for (const [key, icon] of Object.entries(BUSINESS_ICONS)) {
                if (lowerName.includes(key)) {
                    return icon;
                }
            }
            return 'üìÅ'; // √çcone padr√£o
        }
        
        // Subpastas de campanha conhecidas (google, meta, etc.)
        const CAMPAIGN_SUBFOLDERS = ['google', 'meta', 'facebook', 'instagram', 'tiktok', 'linkedin'];
        
        // Fun√ß√£o auxiliar para codificar caminho corretamente (sem codificar barras)
        function encodePathParts(path) {
            return path.split('/').map(part => encodeURIComponent(part)).join('/');
        }
        
        // Fun√ß√£o para detectar subpastas de campanha em um projeto
        async function detectCampaignSubfolders(basePath) {
            const detected = [];
            const encodedBasePath = encodePathParts(basePath);
            
            for (const subfolder of CAMPAIGN_SUBFOLDERS) {
                try {
                    const url = `/${encodedBasePath}/${subfolder}/index.html`;
                    const response = await fetch(url, {
                        method: 'GET',
                        cache: 'no-cache'
                    });
                    
                    // Verifica se √© realmente um HTML v√°lido (status 200 e content-type)
                    if (response.ok && response.status === 200) {
                        const contentType = response.headers.get('content-type') || '';
                        const text = await response.text();
                        
                        // Verifica se cont√©m HTML (doctype ou tag html)
                        if ((contentType.includes('text/html') || text.toLowerCase().includes('<!doctype') || text.toLowerCase().includes('<html'))) {
                            detected.push(subfolder);
                            console.log(`   üìÅ Subpasta detectada: ${basePath}/${subfolder}`);
                        }
                    }
                } catch (e) {
                    // Subpasta n√£o existe ou erro de rede
                }
            }
            
            return detected;
        }
        
        // Fun√ß√£o para construir URL ao vivo com subpasta
        function buildLiveUrlWithSubfolder(baseLiveUrl, subfolder) {
            if (!baseLiveUrl) return '';
            // Remove barra final se existir
            const cleanUrl = baseLiveUrl.replace(/\/$/, '');
            return `${cleanUrl}/${subfolder}`;
        }
        
        // Fun√ß√£o para verificar se um arquivo HTML existe localmente
        async function checkHtmlExists(localUrl) {
            try {
                const response = await fetch(`/${localUrl}`, {
                    method: 'GET',
                    cache: 'no-cache'
                });
                
                if (response.ok && response.status === 200) {
                    const text = await response.text();
                    // Verifica se √© realmente HTML
                    return text.toLowerCase().includes('<!doctype') || text.toLowerCase().includes('<html');
                }
                return false;
            } catch (e) {
                return false;
            }
        }
        
        async function scanWorkspaceFolders() {
            const btn = document.getElementById('scanFoldersBtn');
            btn.classList.add('scanning');
            btn.disabled = true;
            
            showToast('üîç Escaneando e validando pastas do workspace...', 'info');
            console.log('\nüìÇ Iniciando escaneamento de pastas do workspace...');
            
            try {
                let totalNewProjects = 0;
                let totalRemovedProjects = 0;
                let totalNewClients = 0;
                
                // =============================================
                // FASE 1: REMOVER PROJETOS QUE N√ÉO EXISTEM MAIS
                // =============================================
                console.log('\nüóëÔ∏è FASE 1: Verificando e removendo projetos inexistentes...');
                
                for (const client of projectsData) {
                    console.log(`\nüîç Validando cliente: ${client.company}`);
                    
                    const projectsToRemove = [];
                    
                    for (let i = 0; i < client.projects.length; i++) {
                        const project = client.projects[i];
                        const exists = await checkHtmlExists(project.localUrl);
                        
                        if (!exists) {
                            console.log(`   ‚ùå N√ÉO EXISTE: ${project.name} (${project.localUrl})`);
                            projectsToRemove.push(i);
                        } else {
                            console.log(`   ‚úÖ OK: ${project.name}`);
                        }
                    }
                    
                    // Remove projetos inexistentes (de tr√°s para frente para n√£o afetar √≠ndices)
                    for (let i = projectsToRemove.length - 1; i >= 0; i--) {
                        const removedProject = client.projects.splice(projectsToRemove[i], 1)[0];
                        console.log(`   üóëÔ∏è Removido: ${removedProject.name}`);
                        totalRemovedProjects++;
                    }
                }
                
                // =============================================
                // FASE 2: DETECTAR NOVAS SUBPASTAS DE CAMPANHA
                // =============================================
                console.log('\nüìÅ FASE 2: Detectando novas subpastas de campanha...');
                
                for (const client of projectsData) {
                    console.log(`\nüîç Escaneando cliente: ${client.company}`);
                    
                    // Copia projetos atuais para iterar (evita modificar durante itera√ß√£o)
                    const currentProjects = [...client.projects];
                    
                    for (const project of currentProjects) {
                        // Pular projetos que j√° s√£o subpastas (cont√©m " - Google", " - Meta", etc.)
                        if (project.name.includes(' - Google') || 
                            project.name.includes(' - Meta') ||
                            project.name.includes(' - Facebook')) {
                            continue;
                        }
                        
                        console.log(`   üìÑ Projeto: ${project.name} (${project.path})`);
                        
                        // Detectar subpastas de campanha
                        const campaignSubfolders = await detectCampaignSubfolders(project.path);
                        
                        for (const subfolder of campaignSubfolders) {
                            const subfolderName = subfolder.charAt(0).toUpperCase() + subfolder.slice(1);
                            const newProjectName = `${project.name} - ${subfolderName}`;
                            
                            // Verifica se j√° existe
                            const exists = client.projects.some(p => p.name === newProjectName);
                            
                            if (!exists) {
                                // Construir URLs para a subpasta
                                const baseLocalUrl = project.localUrl.replace('/index.html', '').replace('index.html', '');
                                const newProject = {
                                    name: newProjectName,
                                    path: `${project.path}/${subfolder}`,
                                    localUrl: `${baseLocalUrl}/${subfolder}/index.html`,
                                    liveUrl: buildLiveUrlWithSubfolder(project.liveUrl, subfolder),
                                    status: 'active'
                                };
                                
                                client.projects.push(newProject);
                                totalNewProjects++;
                                
                                console.log(`   ‚úÖ Adicionado: ${newProjectName}`);
                                console.log(`      Local: ${newProject.localUrl}`);
                                console.log(`      Live: ${newProject.liveUrl}`);
                            }
                        }
                    }
                }
                
                // =============================================
                // FASE 3: DETECTAR NOVOS CLIENTES
                // =============================================
                console.log('\nüë§ FASE 3: Detectando novos clientes...');
                
                const knownFolders = [
                    'AMCC', 'BANCA PACHECO', 'ENGITUNNEL', 'INNOV', 'WOLF', 'PROTEC', 'MOTEL XENON',
                    'C√ÇMARA', 'NOVA-PASTA', 'CLIENTE-NOVO'
                ];
                
                for (const folder of knownFolders) {
                    try {
                        const exists = await checkHtmlExists(`${encodeURIComponent(folder)}/index.html`);
                        
                        if (exists) {
                            const clientExists = projectsData.some(c => 
                                c.company.toUpperCase().includes(folder.toUpperCase()) ||
                                folder.toUpperCase().includes(c.company.toUpperCase())
                            );
                            
                            if (!clientExists) {
                                const config = FOLDER_CONFIG[folder] || {
                                    icon: getIconForFolder(folder),
                                    description: 'Novo cliente detectado',
                                    subfolders: []
                                };
                                
                                const newClient = {
                                    company: folder,
                                    companyIcon: config.icon,
                                    description: config.description,
                                    projects: [{
                                        name: 'P√°gina Principal',
                                        path: folder,
                                        localUrl: `${encodeURIComponent(folder)}/index.html`,
                                        liveUrl: '',
                                        status: 'active'
                                    }]
                                };
                                
                                projectsData.push(newClient);
                                totalNewClients++;
                                console.log(`üÜï Novo cliente: ${folder}`);
                            }
                        }
                    } catch (e) {
                        // Pasta n√£o acess√≠vel
                    }
                }
                
                // =============================================
                // SALVA E RE-RENDERIZA
                // =============================================
                
                // Salva no localStorage
                saveProjectsToStorage(projectsData);
                
                // Re-renderiza
                renderProjects();
                
                // Mostra resultado
                const messages = [];
                if (totalRemovedProjects > 0) messages.push(`${totalRemovedProjects} removido(s)`);
                if (totalNewProjects > 0) messages.push(`${totalNewProjects} novo(s)`);
                if (totalNewClients > 0) messages.push(`${totalNewClients} cliente(s)`);
                
                if (messages.length > 0) {
                    showToast(`‚úÖ Sincronizado: ${messages.join(', ')}!`, 'success');
                } else {
                    showToast('‚úÖ Todas as pastas j√° est√£o sincronizadas!', 'success');
                }
                
                console.log(`\nüìä RESUMO:`);
                console.log(`   üóëÔ∏è Removidos: ${totalRemovedProjects}`);
                console.log(`   ‚ûï Novos projetos: ${totalNewProjects}`);
                console.log(`   üë§ Novos clientes: ${totalNewClients}`);
                
                // Atualiza data
                document.getElementById('updateDate').textContent = new Date().toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
            } catch (error) {
                console.error('‚ùå Erro ao escanear pastas:', error);
                showToast('‚ùå Erro ao escanear pastas. Verifique o console.', 'error');
            } finally {
                btn.classList.remove('scanning');
                btn.disabled = false;
            }
        }
        
        // Fun√ß√£o para adicionar cliente manualmente via console
        // Uso: addClient('NOME-PASTA', 'üè¢', 'Descri√ß√£o do cliente')
        window.addClient = function(folderName, icon = 'üìÅ', description = 'Novo cliente') {
            const exists = projectsData.some(c => c.company.toUpperCase() === folderName.toUpperCase());
            
            if (exists) {
                console.log(`‚ö†Ô∏è Cliente "${folderName}" j√° existe!`);
                return false;
            }
            
            const newClient = {
                company: folderName,
                companyIcon: icon,
                description: description,
                projects: [{
                    name: 'P√°gina Principal',
                    path: folderName,
                    localUrl: `${encodeURIComponent(folderName)}/index.html`,
                    liveUrl: '',
                    status: 'active'
                }]
            };
            
            projectsData.push(newClient);
            renderProjects();
            
            console.log(`‚úÖ Cliente "${folderName}" adicionado com sucesso!`);
            console.log('üí° Para adicionar projetos a este cliente, use: addProject("' + folderName + '", "Nome do Projeto", "caminho/para/index.html")');
            
            return true;
        };
        
        // Fun√ß√£o para adicionar projeto a um cliente existente
        // Uso: addProject('NOME-CLIENTE', 'Nome do Projeto', 'subpasta/index.html', 'https://url-ao-vivo.com')
        window.addProject = function(clientName, projectName, localPath, liveUrl = '') {
            const client = projectsData.find(c => c.company.toUpperCase() === clientName.toUpperCase());
            
            if (!client) {
                console.log(`‚ö†Ô∏è Cliente "${clientName}" n√£o encontrado!`);
                console.log('üí° Use addClient("' + clientName + '") primeiro.');
                return false;
            }
            
            const exists = client.projects.some(p => p.name === projectName);
            if (exists) {
                console.log(`‚ö†Ô∏è Projeto "${projectName}" j√° existe no cliente "${clientName}"!`);
                return false;
            }
            
            client.projects.push({
                name: projectName,
                path: `${client.company}/${localPath.replace('/index.html', '')}`,
                localUrl: `${encodeURIComponent(client.company)}/${localPath}`,
                liveUrl: liveUrl,
                status: 'active'
            });
            
            renderProjects();
            console.log(`‚úÖ Projeto "${projectName}" adicionado ao cliente "${clientName}"!`);
            
            return true;
        };
        
        // Exibe ajuda no console
        console.log('üìö Dashboard de Projetos - Comandos dispon√≠veis:');
        console.log('  addClient("NOME-PASTA", "üè¢", "Descri√ß√£o") - Adiciona novo cliente');
        console.log('  addProject("CLIENTE", "Projeto", "pasta/index.html", "https://url.com") - Adiciona projeto');
        console.log('  projectsData - Ver todos os dados de clientes/projetos');

        // Search
        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchTerm = e.target.value;
            renderProjects();
        });

        // Close modal on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        // Close modal on outside click
        document.getElementById('previewModal').addEventListener('click', (e) => {
            if (e.target.id === 'previewModal') closeModal();
        });

        // Update date
        document.getElementById('updateDate').textContent = new Date().toLocaleDateString('pt-BR', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });

        // Initial render
        renderProjects();
    </script>
</body>
</html>
